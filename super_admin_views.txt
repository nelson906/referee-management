@extends('layouts.super-admin')

@section('title', 'Impostazioni Sistema')

@section('content')
<div class="container mx-auto px-4 py-8 max-w-6xl">
    {{-- Header --}}
    <div class="mb-8">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">Impostazioni Sistema</h1>
                <p class="mt-2 text-gray-600">Gestisci le configurazioni globali del sistema</p>
            </div>
            <div class="flex space-x-4">
                <button onclick="clearCache()"
                        class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition duration-200 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                    Svuota Cache
                </button>
                <button onclick="optimizeSystem()"
                        class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    Ottimizza Sistema
                </button>
            </div>
        </div>
    </div>

    {{-- Alert Messages --}}
    @if(session('success'))
        <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-6" role="alert">
            <p class="font-bold">Successo!</p>
            <p>{{ session('success') }}</p>
        </div>
    @endif

    @if(session('error'))
        <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6" role="alert">
            <p class="font-bold">Errore!</p>
            <p>{{ session('error') }}</p>
        </div>
    @endif

    {{-- System Info Cards --}}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-2 bg-blue-100 rounded-lg">
                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"></path>
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">PHP Version</p>
                    <p class="text-lg font-semibold text-gray-900">{{ $systemInfo['php_version'] }}</p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-2 bg-green-100 rounded-lg">
                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4"></path>
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Database</p>
                    <p class="text-lg font-semibold text-gray-900">{{ $systemInfo['database_size'] }}</p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-2 bg-purple-100 rounded-lg">
                    <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Storage</p>
                    <p class="text-lg font-semibold text-gray-900">{{ $systemInfo['storage_used'] }}</p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-2 bg-red-100 rounded-lg">
                    <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Log Files</p>
                    <p class="text-lg font-semibold text-gray-900">{{ $systemInfo['log_size'] }}</p>
                </div>
            </div>
        </div>
    </div>

    {{-- Settings Form --}}
    <form action="{{ route('super-admin.settings.update') }}" method="POST" class="space-y-8">
        @csrf

        {{-- Application Settings --}}
        <div class="bg-white shadow-sm rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">Impostazioni Applicazione</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="app_name" class="block text-sm font-medium text-gray-700">
                        Nome Applicazione <span class="text-red-500">*</span>
                    </label>
                    <input type="text" name="app_name" id="app_name"
                           value="{{ old('app_name', $settings['app_name']) }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('app_name') border-red-500 @enderror"
                           required>
                    @error('app_name')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="app_timezone" class="block text-sm font-medium text-gray-700">
                        Timezone <span class="text-red-500">*</span>
                    </label>
                    <select name="app_timezone" id="app_timezone"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('app_timezone') border-red-500 @enderror"
                            required>
                        <option value="Europe/Rome" {{ $settings['app_timezone'] === 'Europe/Rome' ? 'selected' : '' }}>Europe/Rome</option>
                        <option value="UTC" {{ $settings['app_timezone'] === 'UTC' ? 'selected' : '' }}>UTC</option>
                        <option value="Europe/London" {{ $settings['app_timezone'] === 'Europe/London' ? 'selected' : '' }}>Europe/London</option>
                        <option value="America/New_York" {{ $settings['app_timezone'] === 'America/New_York' ? 'selected' : '' }}>America/New_York</option>
                    </select>
                    @error('app_timezone')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="app_locale" class="block text-sm font-medium text-gray-700">
                        Lingua <span class="text-red-500">*</span>
                    </label>
                    <select name="app_locale" id="app_locale"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('app_locale') border-red-500 @enderror"
                            required>
                        <option value="it" {{ $settings['app_locale'] === 'it' ? 'selected' : '' }}>Italiano</option>
                        <option value="en" {{ $settings['app_locale'] === 'en' ? 'selected' : '' }}>English</option>
                        <option value="fr" {{ $settings['app_locale'] === 'fr' ? 'selected' : '' }}>Français</option>
                        <option value="de" {{ $settings['app_locale'] === 'de' ? 'selected' : '' }}>Deutsch</option>
                    </select>
                    @error('app_locale')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="session_lifetime" class="block text-sm font-medium text-gray-700">
                        Durata Sessione (minuti) <span class="text-red-500">*</span>
                    </label>
                    <input type="number" name="session_lifetime" id="session_lifetime"
                           value="{{ old('session_lifetime', $settings['session_lifetime']) }}"
                           min="1" max="1440"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('session_lifetime') border-red-500 @enderror"
                           required>
                    @error('session_lifetime')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>
            </div>

            <div class="mt-6 space-y-4">
                <div class="flex items-center">
                    <input type="checkbox" name="system_debug" id="system_debug" value="1"
                           {{ old('system_debug', $settings['system_debug']) ? 'checked' : '' }}
                           class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    <label for="system_debug" class="ml-2 text-sm text-gray-700">
                        Modalità Debug (solo per sviluppo)
                    </label>
                </div>

                <div class="flex items-center">
                    <input type="checkbox" name="system_maintenance" id="system_maintenance" value="1"
                           {{ old('system_maintenance', $settings['system_maintenance']) ? 'checked' : '' }}
                           class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    <label for="system_maintenance" class="ml-2 text-sm text-gray-700">
                        Modalità Manutenzione
                    </label>
                </div>
            </div>
        </div>

        {{-- Email Settings --}}
        <div class="bg-white shadow-sm rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">Impostazioni Email</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="mail_driver" class="block text-sm font-medium text-gray-700">
                        Driver Mail <span class="text-red-500">*</span>
                    </label>
                    <select name="mail_driver" id="mail_driver"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('mail_driver') border-red-500 @enderror"
                            required>
                        <option value="smtp" {{ $settings['mail_driver'] === 'smtp' ? 'selected' : '' }}>SMTP</option>
                        <option value="sendmail" {{ $settings['mail_driver'] === 'sendmail' ? 'selected' : '' }}>Sendmail</option>
                        <option value="mail" {{ $settings['mail_driver'] === 'mail' ? 'selected' : '' }}>PHP Mail</option>
                        <option value="log" {{ $settings['mail_driver'] === 'log' ? 'selected' : '' }}>Log (Test)</option>
                    </select>
                    @error('mail_driver')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div id="smtp_settings" style="{{ $settings['mail_driver'] !== 'smtp' ? 'display: none;' : '' }}">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="mail_host" class="block text-sm font-medium text-gray-700">
                                Host SMTP
                            </label>
                            <input type="text" name="mail_host" id="mail_host"
                                   value="{{ old('mail_host', $settings['mail_host']) }}"
                                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('mail_host') border-red-500 @enderror">
                        </div>

                        <div>
                            <label for="mail_port" class="block text-sm font-medium text-gray-700">
                                Porta
                            </label>
                            <input type="number" name="mail_port" id="mail_port"
                                   value="{{ old('mail_port', $settings['mail_port']) }}"
                                   class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('mail_port') border-red-500 @enderror">
                        </div>
                    </div>
                </div>

                <div>
                    <label for="mail_from_address" class="block text-sm font-medium text-gray-700">
                        Indirizzo Mittente <span class="text-red-500">*</span>
                    </label>
                    <input type="email" name="mail_from_address" id="mail_from_address"
                           value="{{ old('mail_from_address', $settings['mail_from_address']) }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('mail_from_address') border-red-500 @enderror"
                           required>
                    @error('mail_from_address')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="mail_from_name" class="block text-sm font-medium text-gray-700">
                        Nome Mittente <span class="text-red-500">*</span>
                    </label>
                    <input type="text" name="mail_from_name" id="mail_from_name"
                           value="{{ old('mail_from_name', $settings['mail_from_name']) }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('mail_from_name') border-red-500 @enderror"
                           required>
                    @error('mail_from_name')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>
            </div>
        </div>

        {{-- System Settings --}}
        <div class="bg-white shadow-sm rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">Impostazioni Sistema</h2>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <label for="cache_driver" class="block text-sm font-medium text-gray-700">
                        Driver Cache <span class="text-red-500">*</span>
                    </label>
                    <select name="cache_driver" id="cache_driver"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('cache_driver') border-red-500 @enderror"
                            required>
                        <option value="file" {{ $settings['cache_driver'] === 'file' ? 'selected' : '' }}>File</option>
                        <option value="database" {{ $settings['cache_driver'] === 'database' ? 'selected' : '' }}>Database</option>
                        <option value="redis" {{ $settings['cache_driver'] === 'redis' ? 'selected' : '' }}>Redis</option>
                        <option value="memcached" {{ $settings['cache_driver'] === 'memcached' ? 'selected' : '' }}>Memcached</option>
                    </select>
                </div>

                <div>
                    <label for="log_level" class="block text-sm font-medium text-gray-700">
                        Livello Log <span class="text-red-500">*</span>
                    </label>
                    <select name="log_level" id="log_level"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('log_level') border-red-500 @enderror"
                            required>
                        <option value="debug" {{ $settings['log_level'] === 'debug' ? 'selected' : '' }}>Debug</option>
                        <option value="info" {{ $settings['log_level'] === 'info' ? 'selected' : '' }}>Info</option>
                        <option value="warning" {{ $settings['log_level'] === 'warning' ? 'selected' : '' }}>Warning</option>
                        <option value="error" {{ $settings['log_level'] === 'error' ? 'selected' : '' }}>Error</option>
                    </select>
                </div>

                <div>
                    <label for="api_rate_limit" class="block text-sm font-medium text-gray-700">
                        Limite API (req/ora) <span class="text-red-500">*</span>
                    </label>
                    <input type="number" name="api_rate_limit" id="api_rate_limit"
                           value="{{ old('api_rate_limit', $settings['api_rate_limit']) }}"
                           min="1" max="10000"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('api_rate_limit') border-red-500 @enderror"
                           required>
                </div>
            </div>

            <div class="mt-6 space-y-4">
                <div class="flex items-center">
                    <input type="checkbox" name="backup_enabled" id="backup_enabled" value="1"
                           {{ old('backup_enabled', $settings['backup_enabled']) ? 'checked' : '' }}
                           class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    <label for="backup_enabled" class="ml-2 text-sm text-gray-700">
                        Abilita Backup Automatici
                    </label>
                </div>

                <div id="backup_settings" style="{{ !$settings['backup_enabled'] ? 'display: none;' : '' }}">
                    <label for="backup_frequency" class="block text-sm font-medium text-gray-700">
                        Frequenza Backup
                    </label>
                    <select name="backup_frequency" id="backup_frequency"
                            class="mt-1 block w-full md:w-1/3 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                        <option value="daily" {{ $settings['backup_frequency'] === 'daily' ? 'selected' : '' }}>Giornaliero</option>
                        <option value="weekly" {{ $settings['backup_frequency'] === 'weekly' ? 'selected' : '' }}>Settimanale</option>
                        <option value="monthly" {{ $settings['backup_frequency'] === 'monthly' ? 'selected' : '' }}>Mensile</option>
                    </select>
                </div>
            </div>
        </div>

        {{-- Actions --}}
        <div class="flex justify-end space-x-4">
            <button type="button" onclick="window.location.reload()"
                    class="px-6 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Ripristina
            </button>
            <button type="submit"
                    class="px-6 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Salva Impostazioni
            </button>
        </div>
    </form>

    {{-- System Information --}}
    <div class="mt-8 bg-gray-50 rounded-lg p-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4">Informazioni Sistema</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
            <div>
                <h4 class="font-medium text-gray-900 mb-2">Software</h4>
                <ul class="space-y-1 text-gray-600">
                    <li><strong>Laravel:</strong> {{ $systemInfo['laravel_version'] }}</li>
                    <li><strong>PHP:</strong> {{ $systemInfo['php_version'] }}</li>
                    <li><strong>Server:</strong> {{ $systemInfo['server_software'] }}</li>
                </ul>
            </div>
            <div>
                <h4 class="font-medium text-gray-900 mb-2">Risorse</h4>
                <ul class="space-y-1 text-gray-600">
                    <li><strong>Memoria PHP:</strong> {{ $systemInfo['memory_usage'] }}</li>
                    <li><strong>Storage:</strong> {{ $systemInfo['storage_used'] }}</li>
                    <li><strong>Log:</strong> {{ $systemInfo['log_size'] }}</li>
                </ul>
            </div>
        </div>
    </div>
</div>

@push('scripts')
<script>
// Toggle SMTP settings
document.getElementById('mail_driver').addEventListener('change', function() {
    const smtpSettings = document.getElementById('smtp_settings');
    if (this.value === 'smtp') {
        smtpSettings.style.display = 'block';
    } else {
        smtpSettings.style.display = 'none';
    }
});

// Toggle backup settings
document.getElementById('backup_enabled').addEventListener('change', function() {
    const backupSettings = document.getElementById('backup_settings');
    if (this.checked) {
        backupSettings.style.display = 'block';
    } else {
        backupSettings.style.display = 'none';
    }
});

// Clear cache
function clearCache() {
    if (confirm('Sei sicuro di voler svuotare la cache?')) {
        fetch('{{ route("super-admin.settings.clear-cache") }}', {
            method: 'POST',
            headers: {
                'X-CSRF-TOKEN': '{{ csrf_token() }}',
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
            } else {
                alert('Errore: ' + data.message);
            }
        })
        .catch(error => {
            alert('Errore durante la richiesta');
        });
    }
}

// Optimize system
function optimizeSystem() {
    if (confirm('Vuoi ottimizzare il sistema? Questo potrebbe richiedere alcuni minuti.')) {
        fetch('{{ route("super-admin.settings.optimize") }}', {
            method: 'POST',
            headers: {
                'X-CSRF-TOKEN': '{{ csrf_token() }}',
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
            } else {
                alert('Errore: ' + data.message);
            }
        })
        .catch(error => {
            alert('Errore durante la richiesta');
        });
    }
}
</script>
@endpush
@endsection
@extends('layouts.super-admin')

@section('title', 'Log di Sistema')

@section('content')
<div class="container mx-auto px-4 py-8">
    {{-- Header --}}
    <div class="flex justify-between items-center mb-8">
        <div>
            <h1 class="text-3xl font-bold text-gray-900">Log di Sistema</h1>
            <p class="mt-2 text-gray-600">Monitora le attività e gli errori del sistema</p>
        </div>
        <div class="flex space-x-4">
            <button onclick="refreshLogs()"
                    class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition duration-200 flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                Aggiorna
            </button>
            <button onclick="clearLogs()"
                    class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition duration-200 flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
                Pulisci Log
            </button>
        </div>
    </div>

    {{-- File Selector --}}
    <div class="bg-white rounded-lg shadow p-6 mb-6">
        <div class="flex items-center space-x-4">
            <label for="log-file" class="text-sm font-medium text-gray-700">File di Log:</label>
            <select id="log-file" onchange="changeLogFile()"
                    class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                @foreach($availableFiles as $file)
                    <option value="{{ $file }}" {{ $file === $logFile ? 'selected' : '' }}>
                        {{ $file }}
                    </option>
                @endforeach
            </select>

            <div class="flex space-x-2 ml-auto">
                <label class="inline-flex items-center">
                    <input type="checkbox" id="auto-refresh" class="rounded border-gray-300 text-indigo-600">
                    <span class="ml-2 text-sm text-gray-700">Auto-aggiorna (30s)</span>
                </label>

                <select id="log-level" onchange="filterByLevel()"
                        class="rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                    <option value="">Tutti i livelli</option>
                    <option value="ERROR">Solo Errori</option>
                    <option value="WARNING">Solo Warning</option>
                    <option value="INFO">Solo Info</option>
                    <option value="DEBUG">Solo Debug</option>
                </select>
            </div>
        </div>
    </div>

    {{-- Log Statistics --}}
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-2 bg-red-100 rounded-lg">
                    <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Errori</p>
                    <p class="text-2xl font-semibold text-gray-900" id="error-count">
                        {{ collect($logs)->where('level', 'ERROR')->count() }}
                    </p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-2 bg-yellow-100 rounded-lg">
                    <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Warning</p>
                    <p class="text-2xl font-semibold text-gray-900" id="warning-count">
                        {{ collect($logs)->where('level', 'WARNING')->count() }}
                    </p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-2 bg-blue-100 rounded-lg">
                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Info</p>
                    <p class="text-2xl font-semibold text-gray-900" id="info-count">
                        {{ collect($logs)->where('level', 'INFO')->count() }}
                    </p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-2 bg-green-100 rounded-lg">
                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Totale Voci</p>
                    <p class="text-2xl font-semibold text-gray-900" id="total-count">
                        {{ count($logs) }}
                    </p>
                </div>
            </div>
        </div>
    </div>

    {{-- Log Entries --}}
    <div class="bg-white shadow rounded-lg overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-medium text-gray-900">Voci di Log</h3>
        </div>

        <div class="overflow-x-auto" style="max-height: 600px;">
            @if(count($logs) > 0)
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50 sticky top-0">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Timestamp
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Livello
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Messaggio
                            </th>
                            <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Azioni
                            </th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200" id="log-table-body">
                        @foreach($logs as $index => $log)
                        <tr class="log-entry hover:bg-gray-50" data-level="{{ $log['level'] }}">
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                {{ \Carbon\Carbon::parse($log['timestamp'])->format('d/m/Y H:i:s') }}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full
                                    @switch($log['level'])
                                        @case('ERROR') bg-red-100 text-red-800 @break
                                        @case('WARNING') bg-yellow-100 text-yellow-800 @break
                                        @case('INFO') bg-blue-100 text-blue-800 @break
                                        @case('DEBUG') bg-gray-100 text-gray-800 @break
                                        @default bg-gray-100 text-gray-800
                                    @endswitch">
                                    {{ $log['level'] }}
                                </span>
                            </td>
                            <td class="px-6 py-4 text-sm text-gray-900">
                                <div class="truncate max-w-md" title="{{ $log['message'] }}">
                                    {{ $log['message'] }}
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
                                <button onclick="showFullLog({{ $index }})"
                                        class="text-indigo-600 hover:text-indigo-900">
                                    Dettagli
                                </button>
                            </td>
                        </tr>
                        @endforeach
                    </tbody>
                </table>
            @else
                <div class="px-6 py-12 text-center text-gray-500">
                    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                    </svg>
                    <p class="mt-2">Nessuna voce di log trovata nel file selezionato</p>
                </div>
            @endif
        </div>
    </div>
</div>

{{-- Log Detail Modal --}}
<div id="log-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
    <div class="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
        <div class="mt-3">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-medium text-gray-900">Dettagli Log</h3>
                <button onclick="closeLogModal()" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="bg-gray-100 p-4 rounded-lg">
                <pre id="log-content" class="text-sm text-gray-800 whitespace-pre-wrap break-words"></pre>
            </div>
            <div class="mt-4 flex justify-end">
                <button onclick="closeLogModal()"
                        class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">
                    Chiudi
                </button>
            </div>
        </div>
    </div>
</div>

@push('scripts')
<script>
const logs = @json($logs);
let autoRefreshInterval;

// Change log file
function changeLogFile() {
    const selectedFile = document.getElementById('log-file').value;
    window.location.href = `{{ route('super-admin.system.logs') }}?file=${selectedFile}`;
}

// Filter logs by level
function filterByLevel() {
    const selectedLevel = document.getElementById('log-level').value;
    const rows = document.querySelectorAll('.log-entry');

    rows.forEach(row => {
        if (!selectedLevel || row.dataset.level === selectedLevel) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });

    updateCounts();
}

// Update counts
function updateCounts() {
    const visibleRows = document.querySelectorAll('.log-entry:not([style*="display: none"])');
    const levels = ['ERROR', 'WARNING', 'INFO'];

    levels.forEach(level => {
        const count = Array.from(visibleRows).filter(row => row.dataset.level === level).length;
        const countElement = document.getElementById(level.toLowerCase() + '-count');
        if (countElement) {
            countElement.textContent = count;
        }
    });

    document.getElementById('total-count').textContent = visibleRows.length;
}

// Show full log details
function showFullLog(index) {
    const log = logs[index];
    if (log) {
        document.getElementById('log-content').textContent = log.full_line;
        document.getElementById('log-modal').classList.remove('hidden');
    }
}

// Close log modal
function closeLogModal() {
    document.getElementById('log-modal').classList.add('hidden');
}

// Refresh logs
function refreshLogs() {
    window.location.reload();
}

// Clear logs
function clearLogs() {
    if (confirm('Sei sicuro di voler eliminare tutti i log? Questa azione è irreversibile.')) {
        // Implement log clearing logic
        alert('Funzionalità non ancora implementata');
    }
}

// Auto-refresh functionality
document.getElementById('auto-refresh').addEventListener('change', function() {
    if (this.checked) {
        autoRefreshInterval = setInterval(refreshLogs, 30000);
    } else {
        clearInterval(autoRefreshInterval);
    }
});

// Close modal when clicking outside
window.onclick = function(event) {
    const modal = document.getElementById('log-modal');
    if (event.target === modal) {
        closeLogModal();
    }
}
</script>
@endpush
@endsection
{{-- Form Errors --}}
@if ($errors->any())
    <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6" role="alert">
        <p class="font-bold mb-2">Errori nel form:</p>
        <ul class="list-disc list-inside">
            @foreach ($errors->all() as $error)
                <li>{{ $error }}</li>
            @endforeach
        </ul>
    </div>
@endif

<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    {{-- Informazioni Base --}}
    <div class="col-span-2">
        <h3 class="text-lg font-medium text-gray-900 mb-4">Informazioni Base</h3>
    </div>

    {{-- Nome --}}
    <div>
        <label for="name" class="block text-sm font-medium text-gray-700">
            Nome Categoria <span class="text-red-500">*</span>
        </label>
        <input type="text"
               name="name"
               id="name"
               value="{{ old('name', $tournamentType->name ?? '') }}"
               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('name') border-red-500 @enderror"
               required>
        @error('name')
            <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
        @enderror
    </div>

    {{-- Codice --}}
    <div>
        <label for="short_name" class="block text-sm font-medium text-gray-700">
            Codice <span class="text-red-500">*</span>
        </label>
        <input type="text"
               name="short_name"
               id="short_name"
               value="{{ old('short_name', $tournamentType->short_name ?? '') }}"
               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm uppercase @error('short_name') border-red-500 @enderror"
               pattern="[A-Za-z0-9_-]+"
               title="Solo lettere, numeri, trattini e underscore"
               required>
        <p class="mt-1 text-xs text-gray-500">Es: T18, GN-72, CI</p>
        @error('short_name')
            <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
        @enderror
    </div>

    {{-- Descrizione --}}
    <div class="col-span-2">
        <label for="description" class="block text-sm font-medium text-gray-700">
            Descrizione
        </label>
        <textarea name="description"
                  id="description"
                  rows="3"
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('description') border-red-500 @enderror">{{ old('description', $tournamentType->description ?? '') }}</textarea>
        @error('description')
            <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
        @enderror
    </div>

    {{-- Configurazione Livello --}}
    <div class="col-span-2 mt-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4">Configurazione Livello</h3>
    </div>

    {{-- Livello Categoria --}}
    <div>
        <label for="level" class="block text-sm font-medium text-gray-700">
            Livello Categoria <span class="text-red-500">*</span>
        </label>
        <select name="level"
                id="level"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('level') border-red-500 @enderror"
                required>
            @foreach($categoryLevels as $value => $label)
                <option value="{{ $value }}"
                    {{ old('level', $tournamentType->level ?? 'zonale') == $value ? 'selected' : '' }}>
                    {{ $label }}
                </option>
            @endforeach
        </select>
        @error('level')
            <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
        @enderror
    </div>

    {{-- Categoria Nazionale --}}
    <div>
        <label class="block text-sm font-medium text-gray-700 mb-3">
            Visibilità
        </label>
        <div class="space-y-2">
            <label class="inline-flex items-center">
                <input type="checkbox"
                       name="is_national"
                       id="is_national"
                       value="1"
                       {{ old('is_national', $tournamentType->is_national ?? false) ? 'checked' : '' }}
                       class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                <span class="ml-2 text-sm text-gray-700">
                    Categoria Nazionale (visibile a tutte le zone)
                </span>
            </label>
        </div>
    </div>

    {{-- Zone Visibilità (solo se non nazionale) --}}
    <div class="col-span-2" id="zones-visibility-container" style="{{ old('is_national', $tournamentType->is_national ?? false) ? 'display:none' : '' }}">
        <label class="block text-sm font-medium text-gray-700 mb-2">
            Zone di Visibilità
        </label>
        <div class="grid grid-cols-2 md:grid-cols-3 gap-2 p-4 bg-gray-50 rounded-md">
            @foreach($zones as $zone)
                <label class="inline-flex items-center">
                    <input type="checkbox"
                           name="visibility_zones[]"
                           value="{{ $zone->id }}"
                           {{ in_array($zone->id, old('visibility_zones', $tournamentType->settings['visibility_zones'] ?? [])) ? 'checked' : '' }}
                           class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    <span class="ml-2 text-sm text-gray-700">{{ $zone->name }}</span>
                </label>
            @endforeach
        </div>
        <p class="mt-1 text-xs text-gray-500">Seleziona le zone che possono vedere questa categoria</p>
    </div>

    {{-- Configurazione Arbitri --}}
    <div class="col-span-2 mt-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4">Configurazione Arbitri</h3>
    </div>

    {{-- Livello Arbitro Richiesto --}}
    <div>
        <label for="required_referee_level" class="block text-sm font-medium text-gray-700">
            Livello Arbitro Minimo <span class="text-red-500">*</span>
        </label>
        <select name="required_referee_level"
                id="required_referee_level"
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('required_referee_level') border-red-500 @enderror"
                required>
            @foreach($refereeLevels as $value => $label)
                <option value="{{ $value }}"
                    {{ old('required_referee_level', $tournamentType->required_referee_level ?? 'aspirante') == $value ? 'selected' : '' }}>
                    {{ $label }}
                </option>
            @endforeach
        </select>
        @error('required_referee_level')
            <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
        @enderror
    </div>

    {{-- Numero Arbitri --}}
    <div>
        <div class="grid grid-cols-2 gap-4">
            <div>
                <label for="min_referees" class="block text-sm font-medium text-gray-700">
                    Numero Minimo <span class="text-red-500">*</span>
                </label>
                <input type="number"
                       name="min_referees"
                       id="min_referees"
                       min="1"
                       max="10"
                       value="{{ old('min_referees', $tournamentType->min_referees ?? 1) }}"
                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('min_referees') border-red-500 @enderror"
                       required>
                @error('min_referees')
                    <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                @enderror
            </div>

            <div>
                <label for="max_referees" class="block text-sm font-medium text-gray-700">
                    Numero Massimo <span class="text-red-500">*</span>
                </label>
                <input type="number"
                       name="max_referees"
                       id="max_referees"
                       min="1"
                       max="10"
                       value="{{ old('max_referees', $tournamentType->max_referees ?? 1) }}"
                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('max_referees') border-red-500 @enderror"
                       required>
                @error('max_referees')
                    <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                @enderror
            </div>
        </div>
    </div>

    {{-- Requisiti Speciali --}}
    <div class="col-span-2">
        <label for="special_requirements" class="block text-sm font-medium text-gray-700">
            Requisiti Speciali
        </label>
        <textarea name="special_requirements"
                  id="special_requirements"
                  rows="3"
                  class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('special_requirements') border-red-500 @enderror"
                  placeholder="Es: Richiesta esperienza in tornei maggiori, certificazione specifica, ecc.">{{ old('special_requirements', $tournamentType->special_requirements ?? '') }}</textarea>
        @error('special_requirements')
            <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
        @enderror
    </div>

    {{-- Impostazioni Aggiuntive --}}
    <div class="col-span-2 mt-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4">Impostazioni Aggiuntive</h3>
    </div>

    {{-- Ordine Visualizzazione --}}
    <div>
        <label for="sort_order" class="block text-sm font-medium text-gray-700">
            Ordine Visualizzazione
        </label>
        <input type="number"
               name="sort_order"
               id="sort_order"
               min="0"
               value="{{ old('sort_order', $tournamentType->sort_order ?? 0) }}"
               class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('sort_order') border-red-500 @enderror">
        <p class="mt-1 text-xs text-gray-500">Ordine crescente (0 = primo)</p>
        @error('sort_order')
            <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
        @enderror
    </div>

    {{-- Stato Attivo --}}
    <div>
        <label class="block text-sm font-medium text-gray-700 mb-3">
            Stato
        </label>
        <div class="space-y-2">
            <label class="inline-flex items-center">
                <input type="checkbox"
                       name="is_active"
                       id="is_active"
                       value="1"
                       {{ old('is_active', $tournamentType->is_active ?? true) ? 'checked' : '' }}
                       class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                <span class="ml-2 text-sm text-gray-700">
                    Categoria Attiva
                </span>
            </label>
            <p class="text-xs text-gray-500">Le categorie non attive non sono disponibili per i nuovi tornei</p>
        </div>
    </div>
</div>

@push('scripts')
<script>
// Toggle zones visibility based on national checkbox
document.getElementById('is_national').addEventListener('change', function() {
    const zonesContainer = document.getElementById('zones-visibility-container');
    if (this.checked) {
        zonesContainer.style.display = 'none';
        // Uncheck all zones
        document.querySelectorAll('input[name="visibility_zones[]"]').forEach(checkbox => {
            checkbox.checked = false;
        });
    } else {
        zonesContainer.style.display = 'block';
    }
});

// Validate min/max referees
document.getElementById('min_referees').addEventListener('change', function() {
    const maxInput = document.getElementById('max_referees');
    if (parseInt(maxInput.value) < parseInt(this.value)) {
        maxInput.value = this.value;
    }
    maxInput.min = this.value;
});

// Auto uppercase for short_name
document.getElementById('short_name').addEventListener('input', function() {
    this.value = this.value.toUpperCase();
});
</script>
@endpush
@extends('layouts.super-admin')

@section('title', 'Nuova Tipo Gara')

@section('content')
<div class="container mx-auto px-4 py-8 max-w-4xl">
    {{-- Header --}}
    <div class="mb-8">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">Nuova Tipo Gara</h1>
                <p class="mt-2 text-gray-600">Crea una nuova categoria per organizzare i tornei</p>
            </div>
            <a href="{{ route('super-admin.tournament-types.index') }}"
               class="text-gray-600 hover:text-gray-900 flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                Torna all'elenco
            </a>
        </div>
    </div>

    {{-- Form --}}
    <form action="{{ route('super-admin.tournament-types.store') }}" method="POST" class="space-y-6">
        @csrf

        <div class="bg-white shadow-sm rounded-lg p-6">
            @include('super-admin.tournament-types._form')
        </div>

        {{-- Actions --}}
        <div class="flex justify-end space-x-4">
            <a href="{{ route('super-admin.tournament-types.index') }}"
               class="px-6 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Annulla
            </a>
            <button type="submit"
                    class="px-6 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Crea Categoria
            </button>
        </div>
    </form>

    {{-- Help Box --}}
    <div class="mt-8 bg-gray-50 rounded-lg p-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4">Guida alla creazione delle categorie</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm text-gray-600">
            <div>
                <h4 class="font-medium text-gray-900 mb-2">🏌️ Categorie Zonali</h4>
                <ul class="space-y-1 list-disc list-inside">
                    <li>Visibili solo alle zone selezionate</li>
                    <li>Per tornei locali e regionali</li>
                    <li>Es: Gara Sociale, Coppa del Circolo</li>
                </ul>
            </div>
            <div>
                <h4 class="font-medium text-gray-900 mb-2">🏆 Categorie Nazionali</h4>
                <ul class="space-y-1 list-disc list-inside">
                    <li>Visibili a tutte le zone</li>
                    <li>Per tornei federali e major</li>
                    <li>Es: Open Nazionali, Campionati</li>
                </ul>
            </div>
            <div>
                <h4 class="font-medium text-gray-900 mb-2">📋 Livelli Arbitro</h4>
                <ul class="space-y-1 list-disc list-inside">
                    <li><strong>Aspirante/1° Livello:</strong> Tornei base</li>
                    <li><strong>Regionale:</strong> Tornei regionali</li>
                    <li><strong>Nazionale/Int.:</strong> Tornei maggiori</li>
                </ul>
            </div>
            <div>
                <h4 class="font-medium text-gray-900 mb-2">🎨 Codici Suggeriti</h4>
                <ul class="space-y-1 list-disc list-inside">
                    <li><strong>T18:</strong> 18 buche</li>
                    <li><strong>GN-36/54/72:</strong> Gare nazionali</li>
                    <li><strong>CI:</strong> Coppa Italia</li>
                    <li><strong>CNZ/TNZ:</strong> Campionati/Trofei</li>
                </ul>
            </div>
        </div>
    </div>
</div>
@endsection
@extends('layouts.super-admin')

@section('title', 'Modifica Tipo: ' . $tournamentType->name)

@section('content')
<div class="container mx-auto px-4 py-8 max-w-4xl">
    {{-- Header --}}
    <div class="mb-8">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">Modifica Tipo Gara</h1>
                <p class="mt-2 text-gray-600">Modifica le impostazioni del tipo: {{ $tournamentType->name }}</p>
            </div>
            <div class="flex space-x-4">
                <a href="{{ route('super-admin.tournament-types.show', $tournamentType) }}"
                   class="text-gray-600 hover:text-gray-900 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                    </svg>
                    Visualizza
                </a>
                <a href="{{ route('super-admin.tournament-types.index') }}"
                   class="text-gray-600 hover:text-gray-900 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    Torna all'elenco
                </a>
            </div>
        </div>
    </div>

    {{-- Alert if category has tournaments --}}
    @if($tournamentType->tournaments()->exists())
    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
        <div class="flex">
            <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                </svg>
            </div>
            <div class="ml-3">
                <p class="text-sm text-yellow-700">
                    <strong>Attenzione:</strong> Questa categoria ha {{ $tournamentType->tournaments()->count() }} tornei associati.
                    Le modifiche influenzeranno tutti i tornei esistenti.
                </p>
            </div>
        </div>
    </div>
    @endif

    {{-- Form --}}
    <form action="{{ route('super-admin.tournament-types.update', $tournamentType) }}" method="POST" class="space-y-6">
        @csrf
        @method('PUT')

        <div class="bg-white shadow-sm rounded-lg p-6">
            @include('super-admin.tournament-types._form')
        </div>

        {{-- Actions --}}
        <div class="flex justify-between">
            <div>
                @if(!$tournamentType->tournaments()->exists())
                <button type="button"
                        onclick="confirmDelete()"
                        class="px-4 py-2 border border-red-300 rounded-md shadow-sm text-sm font-medium text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                    <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                    Elimina Tipo
                </button>
                @endif
            </div>
            <div class="flex space-x-4">
                <a href="{{ route('super-admin.tournament-types.index') }}"
                   class="px-6 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Annulla
                </a>
                <button type="submit"
                        class="px-6 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Salva Modifiche
                </button>
            </div>
        </div>
    </form>

    {{-- Category Stats --}}
    <div class="mt-8 bg-gray-50 rounded-lg p-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4">Statistiche Categoria</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-white rounded-lg p-4 text-center">
                <div class="text-2xl font-bold text-indigo-600">{{ $tournamentType->tournaments()->count() }}</div>
                <div class="text-sm text-gray-600">Tornei Totali</div>
            </div>
            <div class="bg-white rounded-lg p-4 text-center">
                <div class="text-2xl font-bold text-green-600">{{ $tournamentType->tournaments()->where('status', 'open')->count() }}</div>
                <div class="text-sm text-gray-600">Tornei Aperti</div>
            </div>
            <div class="bg-white rounded-lg p-4 text-center">
                <div class="text-2xl font-bold text-blue-600">{{ $tournamentType->tournaments()->where('status', 'completed')->count() }}</div>
                <div class="text-sm text-gray-600">Tornei Completati</div>
            </div>
        </div>
    </div>
</div>

{{-- Delete Form (hidden) --}}
<form id="delete-form" action="{{ route('super-admin.tournament-types.destroy', $tournamentType) }}" method="POST" style="display: none;">
    @csrf
    @method('DELETE')
</form>

@push('scripts')
<script>
function confirmDelete() {
    if (confirm('Sei sicuro di voler eliminare questa categoria? Questa azione è irreversibile.')) {
        document.getElementById('delete-form').submit();
    }
}
</script>
@endpush
@endsection
@extends('layouts.super-admin')

@section('title', 'Gestione Categorie Tornei')

@section('content')
<div class="container mx-auto px-4 py-8">
    {{-- Header --}}
    <div class="flex justify-between items-center mb-8">
        <div>
            <h1 class="text-3xl font-bold text-gray-900">Categorie Tornei</h1>
            <p class="mt-2 text-gray-600">Gestisci le categorie dei tornei del sistema</p>
        </div>
        <a href="{{ route('super-admin.tournament-types.create') }}"
           class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition duration-200 flex items-center">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
            Nuovo Tipo
        </a>
    </div>

    {{-- Alert Messages --}}
    @if(session('success'))
        <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-6" role="alert">
            <p class="font-bold">Successo!</p>
            <p>{{ session('success') }}</p>
        </div>
    @endif

    @if(session('error'))
        <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6" role="alert">
            <p class="font-bold">Errore!</p>
            <p>{{ session('error') }}</p>
        </div>
    @endif

    {{-- Categories Table --}}
    <div class="bg-white shadow-xl rounded-lg overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Ordine
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Nome / Codice
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Livello
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Arbitri
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Tornei
                    </th>
                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Stato
                    </th>
                    <th scope="col" class="relative px-6 py-3">
                        <span class="sr-only">Azioni</span>
                    </th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200" id="sortable-categories">
                @foreach($tournamentTypes as $type)
                <tr data-id="{{ $type->id }}" class="hover:bg-gray-50 transition-colors duration-150">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <svg class="w-5 h-5 text-gray-400 cursor-move handle" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                            </svg>
                            <span class="ml-2 text-sm text-gray-500">{{ $type->sort_order }}</span>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <div class="w-3 h-3 rounded-full mr-3"
                                 style="background-color: {{ $type->calendar_color }}"></div>
                            <div>
                                <div class="text-sm font-medium text-gray-900">
                                    {{ $type->name }}
                                </div>
                                <div class="text-sm text-gray-500">
                                    Codice: {{ $type->short_name }}
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full
                            {{ $type->is_national ? 'bg-blue-100 text-blue-800' : 'bg-green-100 text-green-800' }}">
                            {{ $type->is_national ? 'Nazionale' : 'Zonale' }}
                        </span>
                        <div class="text-xs text-gray-500 mt-1">
                            Min. {{ ucfirst($type->required_referee_level) }}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <div>Min: {{ $type->min_referees }}</div>
                        <div>Max: {{ $type->max_referees }}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        <div class="flex items-center">
                            <span class="font-medium">{{ $type->tournaments_count }}</span>
                            <span class="ml-1 text-gray-500">tornei</span>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                        <button onclick="toggleActive({{ $type->id }})"
                                class="relative inline-flex items-center h-6 rounded-full w-11 transition-colors duration-200 focus:outline-none
                                {{ $type->is_active ? 'bg-green-500' : 'bg-gray-300' }}">
                            <span class="sr-only">Attiva/Disattiva</span>
                            <span class="inline-block w-4 h-4 transform transition-transform duration-200 bg-white rounded-full shadow
                                {{ $type->is_active ? 'translate-x-6' : 'translate-x-1' }}"></span>
                        </button>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <div class="flex items-center justify-end space-x-2">
                            <a href="{{ route('super-admin.tournament-types.show', $type) }}"
                               class="text-gray-600 hover:text-gray-900" title="Visualizza">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </a>
                            <a href="{{ route('super-admin.tournament-types.edit', $type) }}"
                               class="text-indigo-600 hover:text-indigo-900" title="Modifica">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                            </a>
                            <button onclick="duplicateCategory({{ $type->id }})"
                                    class="text-blue-600 hover:text-blue-900" title="Duplica">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                </svg>
                            </button>
                            @if($type->tournaments_count == 0)
                            <form action="{{ route('super-admin.tournament-types.destroy', $type) }}"
                                  method="POST"
                                  class="inline"
                                  onsubmit="return confirm('Sei sicuro di voler eliminare questa categoria?');">
                                @csrf
                                @method('DELETE')
                                <button type="submit" class="text-red-600 hover:text-red-900" title="Elimina">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                </button>
                            </form>
                            @endif
                        </div>
                    </td>
                </tr>
                @endforeach
            </tbody>
        </table>
    </div>

    {{-- Info Box --}}
    <div class="mt-8 bg-blue-50 border-l-4 border-blue-400 p-4">
        <div class="flex">
            <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                </svg>
            </div>
            <div class="ml-3">
                <p class="text-sm text-blue-700">
                    <strong>Suggerimento:</strong> Puoi riordinare le categorie trascinandole.
                    Le categorie nazionali sono visibili a tutte le zone, mentre quelle zonali solo alle zone selezionate.
                </p>
            </div>
        </div>
    </div>
</div>

@push('scripts')
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
<script>
// Sortable categories
document.addEventListener('DOMContentLoaded', function() {
    const sortable = Sortable.create(document.getElementById('sortable-categories'), {
        handle: '.handle',
        animation: 150,
        onEnd: function(evt) {
            const categories = [];
            document.querySelectorAll('#sortable-categories tr').forEach((row, index) => {
                categories.push({
                    id: row.dataset.id,
                    sort_order: index * 10
                });
            });

            fetch('{{ route("super-admin.tournament-types.update-order") }}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': '{{ csrf_token() }}'
                },
                body: JSON.stringify({ categories })
            });
        }
    });
});

// Toggle active status
function toggleActive(categoryId) {
    fetch(`/super-admin/tournament-types/${categoryId}/toggle-active`, {
        method: 'POST',
        headers: {
            'X-CSRF-TOKEN': '{{ csrf_token() }}',
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        }
    });
}

// Duplicate category
function duplicateCategory(categoryId) {
    if (confirm('Vuoi duplicare questa categoria?')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/super-admin/tournament-types/${categoryId}/duplicate`;

        const token = document.createElement('input');
        token.type = 'hidden';
        token.name = '_token';
        token.value = '{{ csrf_token() }}';
        form.appendChild(token);

        document.body.appendChild(form);
        form.submit();
    }
}
</script>
@endpush
@endsection
@extends('layouts.super-admin')

@section('title', 'Tipo: ' . $tournamentType->name)

@section('content')
<div class="container mx-auto px-4 py-8 max-w-6xl">
    {{-- Header --}}
    <div class="mb-8">
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <div class="w-4 h-4 rounded-full mr-4"
                     style="background-color: {{ $tournamentType->calendar_color }}"></div>
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">{{ $tournamentType->name }}</h1>
                    <p class="mt-1 text-gray-600">Codice: {{ $tournamentType->code }}</p>
                </div>
            </div>
            <div class="flex space-x-4">
                <a href="{{ route('super-admin.tournament-types.edit', $tournamentType) }}"
                   class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition duration-200 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                    Modifica
                </a>
                <a href="{{ route('super-admin.tournament-types.index') }}"
                   class="text-gray-600 hover:text-gray-900 flex items-center px-4 py-2">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    Torna all'elenco
                </a>
            </div>
        </div>
    </div>

    {{-- Status Badge --}}
    <div class="mb-6">
        <span class="px-3 py-1 inline-flex text-sm leading-5 font-semibold rounded-full
            {{ $tournamentType->is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800' }}">
            {{ $tournamentType->is_active ? 'Attiva' : 'Non Attiva' }}
        </span>
        <span class="ml-2 px-3 py-1 inline-flex text-sm leading-5 font-semibold rounded-full
            {{ $tournamentType->is_national ? 'bg-blue-100 text-blue-800' : 'bg-gray-100 text-gray-800' }}">
            {{ $tournamentType->is_national ? 'Nazionale' : 'Zonale' }}
        </span>
    </div>

    {{-- Info Grid --}}
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        {{-- Dettagli Categoria --}}
        <div class="bg-white shadow rounded-lg p-6">
            <h2 class="text-lg font-medium text-gray-900 mb-4">Dettagli Categoria</h2>
            <dl class="space-y-3">
                @if($tournamentType->description)
                <div>
                    <dt class="text-sm font-medium text-gray-500">Descrizione</dt>
                    <dd class="mt-1 text-sm text-gray-900">{{ $tournamentType->description }}</dd>
                </div>
                @endif

                <div>
                    <dt class="text-sm font-medium text-gray-500">Livello Categoria</dt>
                    <dd class="mt-1 text-sm text-gray-900">{{ ucfirst($tournamentType->level) }}</dd>
                </div>

                <div>
                    <dt class="text-sm font-medium text-gray-500">Ordine Visualizzazione</dt>
                    <dd class="mt-1 text-sm text-gray-900">{{ $tournamentType->sort_order }}</dd>
                </div>

                <div>
                    <dt class="text-sm font-medium text-gray-500">Visibilità</dt>
                    <dd class="mt-1 text-sm text-gray-900">
                        @if($tournamentType->is_national)
                            Tutte le zone
                        @else
                            @if(is_array($tournamentType->visibility_zones) && count($tournamentType->visibility_zones) > 0)
                                {{ count($tournamentType->visibility_zones) }} zone selezionate
                            @else
                                Solo zona proprietaria
                            @endif
                        @endif
                    </dd>
                </div>
            </dl>
        </div>

        {{-- Configurazione Arbitri --}}
        <div class="bg-white shadow rounded-lg p-6">
            <h2 class="text-lg font-medium text-gray-900 mb-4">Configurazione Arbitri</h2>
            <dl class="space-y-3">
                <div>
                    <dt class="text-sm font-medium text-gray-500">Livello Arbitro Minimo</dt>
                    <dd class="mt-1 text-sm text-gray-900">
                        {{ App\Models\TournamentType::REFEREE_LEVELS[$tournamentType->required_referee_level] ?? 'Non specificato' }}
                    </dd>
                </div>

                <div>
                    <dt class="text-sm font-medium text-gray-500">Numero Arbitri</dt>
                    <dd class="mt-1 text-sm text-gray-900">
                        Minimo: {{ $tournamentType->min_referees }} -
                        Massimo: {{ $tournamentType->max_referees }}
                    </dd>
                </div>

                @if($tournamentType->special_requirements)
                <div>
                    <dt class="text-sm font-medium text-gray-500">Requisiti Speciali</dt>
                    <dd class="mt-1 text-sm text-gray-900">{{ $tournamentType->special_requirements }}</dd>
                </div>
                @endif
            </dl>
        </div>
    </div>

    {{-- Statistiche --}}
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <div class="bg-white rounded-lg shadow p-6 text-center">
            <div class="text-3xl font-bold text-indigo-600">{{ $tournamentType->tournaments_count }}</div>
            <div class="text-sm text-gray-600 mt-1">Tornei Totali</div>
        </div>
        <div class="bg-white rounded-lg shadow p-6 text-center">
            <div class="text-3xl font-bold text-green-600">
                {{ $tournamentType->tournaments()->where('status', 'open')->count() }}
            </div>
            <div class="text-sm text-gray-600 mt-1">Tornei Aperti</div>
        </div>
        <div class="bg-white rounded-lg shadow p-6 text-center">
            <div class="text-3xl font-bold text-blue-600">
                {{ $tournamentType->tournaments()->where('status', 'assigned')->count() }}
            </div>
            <div class="text-sm text-gray-600 mt-1">Con Arbitri Assegnati</div>
        </div>
        <div class="bg-white rounded-lg shadow p-6 text-center">
            <div class="text-3xl font-bold text-gray-600">
                {{ $tournamentType->tournaments()->where('status', 'completed')->count() }}
            </div>
            <div class="text-sm text-gray-600 mt-1">Completati</div>
        </div>
    </div>

    {{-- Tornei Recenti --}}
    <div class="bg-white shadow rounded-lg overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-lg font-medium text-gray-900">Tornei Recenti</h2>
        </div>

        @if($recentTournaments->count() > 0)
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Torneo
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Circolo
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Zona
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Date
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Stato
                        </th>
                        <th scope="col" class="relative px-6 py-3">
                            <span class="sr-only">Azioni</span>
                        </th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    @foreach($recentTournaments as $tournament)
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900">
                                {{ $tournament->name }}
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {{ $tournament->club->name ?? 'N/A' }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {{ $tournament->zone->name ?? 'N/A' }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {{ \Carbon\Carbon::parse($tournament->start_date)->format('d/m/Y') }} -
                            {{ \Carbon\Carbon::parse($tournament->end_date)->format('d/m/Y') }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full
                                @switch($tournament->status)
                                    @case('open') bg-green-100 text-green-800 @break
                                    @case('closed') bg-yellow-100 text-yellow-800 @break
                                    @case('assigned') bg-blue-100 text-blue-800 @break
                                    @case('completed') bg-gray-100 text-gray-800 @break
                                    @default bg-gray-100 text-gray-800
                                @endswitch">
                                {{ ucfirst($tournament->status) }}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <a href="{{ route('tournaments.show', $tournament) }}"
                               class="text-indigo-600 hover:text-indigo-900">
                                Visualizza
                            </a>
                        </td>
                    </tr>
                    @endforeach
                </tbody>
            </table>
        </div>

        @if($tournamentType->tournaments_count > 10)
        <div class="bg-gray-50 px-6 py-3 text-center">
            <a href="{{ route('admin.tournaments.index', ['tournament_type_id' => $tournamentType->id]) }}"
               class="text-sm text-indigo-600 hover:text-indigo-900">
                Vedi tutti i {{ $tournamentType->tournaments_count }} tornei →
            </a>
        </div>
        @endif

        @else
        <div class="px-6 py-12 text-center text-gray-500">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
            </svg>
            <p class="mt-2">Nessun torneo trovato per questa categoria</p>
        </div>
        @endif
    </div>
</div>
@endsection
@extends('layouts.super-admin')

@section('title', 'Nuovo Utente')

@section('content')
<div class="container mx-auto px-4 py-8 max-w-4xl">
    {{-- Header --}}
    <div class="mb-8">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">Nuovo Utente</h1>
                <p class="mt-2 text-gray-600">Crea un nuovo utente nel sistema</p>
            </div>
            <a href="{{ route('super-admin.users.index') }}"
               class="text-gray-600 hover:text-gray-900 flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                Torna all'elenco
            </a>
        </div>
    </div>

    {{-- Form --}}
    <form action="{{ route('super-admin.users.store') }}" method="POST" enctype="multipart/form-data" class="space-y-6">
        @csrf

        {{-- Basic Information --}}
        <div class="bg-white shadow-sm rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">Informazioni Base</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="col-span-2">
                    <label for="name" class="block text-sm font-medium text-gray-700">
                        Nome Completo <span class="text-red-500">*</span>
                    </label>
                    <input type="text" name="name" id="name"
                           value="{{ old('name') }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('name') border-red-500 @enderror"
                           required>
                    @error('name')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700">
                        Email <span class="text-red-500">*</span>
                    </label>
                    <input type="email" name="email" id="email"
                           value="{{ old('email') }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('email') border-red-500 @enderror"
                           required>
                    @error('email')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="codice_tessera" class="block text-sm font-medium text-gray-700">
                        Codice Tessera
                    </label>
                    <input type="text" name="codice_tessera" id="codice_tessera"
                           value="{{ old('codice_tessera') }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('codice_tessera') border-red-500 @enderror">
                    @error('codice_tessera')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700">
                        Password <span class="text-red-500">*</span>
                    </label>
                    <input type="password" name="password" id="password"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('password') border-red-500 @enderror"
                           required>
                    @error('password')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="password_confirmation" class="block text-sm font-medium text-gray-700">
                        Conferma Password <span class="text-red-500">*</span>
                    </label>
                    <input type="password" name="password_confirmation" id="password_confirmation"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"
                           required>
                </div>
            </div>
        </div>

        {{-- User Type and Zone --}}
        <div class="bg-white shadow-sm rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">Tipo Utente e Zona</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="user_type" class="block text-sm font-medium text-gray-700">
                        Tipo Utente <span class="text-red-500">*</span>
                    </label>
                    <select name="user_type" id="user_type"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('user_type') border-red-500 @enderror"
                            required onchange="toggleFields()">
                        <option value="">Seleziona tipo utente</option>
                        @foreach($userTypes as $value => $label)
                            <option value="{{ $value }}" {{ old('user_type') === $value ? 'selected' : '' }}>
                                {{ $label }}
                            </option>
                        @endforeach
                    </select>
                    @error('user_type')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div id="zone-field" style="{{ old('user_type') && old('user_type') !== 'super_admin' && old('user_type') !== 'national_admin' ? '' : 'display: none;' }}">
                    <label for="zone_id" class="block text-sm font-medium text-gray-700">
                        Zona <span class="text-red-500" id="zone-required" style="display: none;">*</span>
                    </label>
                    <select name="zone_id" id="zone_id"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('zone_id') border-red-500 @enderror">
                        <option value="">Seleziona zona</option>
                        @foreach($zones as $zone)
                            <option value="{{ $zone->id }}" {{ old('zone_id') == $zone->id ? 'selected' : '' }}>
                                {{ $zone->name }}
                            </option>
                        @endforeach
                    </select>
                    @error('zone_id')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>
            </div>

            <div id="referee-fields" class="mt-6" style="{{ old('user_type') === 'referee' ? '' : 'display: none;' }}">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Informazioni Arbitro</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="livello_arbitro" class="block text-sm font-medium text-gray-700">
                            Livello Arbitro
                        </label>
                        <select name="livello_arbitro" id="livello_arbitro"
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            <option value="">Seleziona livello</option>
                            @foreach($refereeLevels as $value => $label)
                                <option value="{{ $value }}" {{ old('livello_arbitro') === $value ? 'selected' : '' }}>
                                    {{ $label }}
                                </option>
                            @endforeach
                        </select>
                    </div>
                </div>
            </div>
        </div>

        {{-- Contact Information --}}
        <div class="bg-white shadow-sm rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">Informazioni di Contatto</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="telefono" class="block text-sm font-medium text-gray-700">
                        Telefono
                    </label>
                    <input type="tel" name="telefono" id="telefono"
                           value="{{ old('telefono') }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('telefono') border-red-500 @enderror">
                    @error('telefono')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="data_nascita" class="block text-sm font-medium text-gray-700">
                        Data di Nascita
                    </label>
                    <input type="date" name="data_nascita" id="data_nascita"
                           value="{{ old('data_nascita') }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('data_nascita') border-red-500 @enderror">
                    @error('data_nascita')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div class="col-span-2">
                    <label for="indirizzo" class="block text-sm font-medium text-gray-700">
                        Indirizzo
                    </label>
                    <input type="text" name="indirizzo" id="indirizzo"
                           value="{{ old('indirizzo') }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('indirizzo') border-red-500 @enderror">
                    @error('indirizzo')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="citta" class="block text-sm font-medium text-gray-700">
                        Città
                    </label>
                    <input type="text" name="citta" id="citta"
                           value="{{ old('citta') }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('citta') border-red-500 @enderror">
                    @error('citta')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="cap" class="block text-sm font-medium text-gray-700">
                        CAP
                    </label>
                    <input type="text" name="cap" id="cap"
                           value="{{ old('cap') }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('cap') border-red-500 @enderror">
                    @error('cap')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>
            </div>
        </div>

        {{-- Profile Photo --}}
        <div class="bg-white shadow-sm rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">Foto Profilo</h2>

            <div>
                <label for="profile_photo" class="block text-sm font-medium text-gray-700">
                    Foto Profilo
                </label>
                <div class="mt-1 flex items-center space-x-4">
                    <div class="flex-shrink-0">
                        <img id="photo-preview" class="h-20 w-20 rounded-full object-cover bg-gray-200"
                             src="data:image/svg+xml,%3csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100' height='100' fill='%23e5e7eb'/%3e%3ctext x='50%25' y='50%25' font-size='16' text-anchor='middle' dy='.3em' fill='%236b7280'%3eUser%3c/text%3e%3c/svg%3e"
                             alt="Preview">
                    </div>
                    <input type="file" name="profile_photo" id="profile_photo"
                           accept="image/*"
                           class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"
                           onchange="previewPhoto(this)">
                </div>
                <p class="mt-1 text-sm text-gray-500">PNG, JPG, JPEG fino a 2MB</p>
                @error('profile_photo')
                    <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                @enderror
            </div>
        </div>

        {{-- Status --}}
        <div class="bg-white shadow-sm rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">Stato</h2>

            <div class="space-y-4">
                <div class="flex items-center">
                    <input type="checkbox" name="is_active" id="is_active" value="1"
                           {{ old('is_active', true) ? 'checked' : '' }}
                           class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    <label for="is_active" class="ml-2 text-sm text-gray-700">
                        Utente Attivo
                    </label>
                </div>
                <p class="text-xs text-gray-500">Gli utenti non attivi non possono accedere al sistema</p>
            </div>
        </div>

        {{-- Actions --}}
        <div class="flex justify-end space-x-4">
            <a href="{{ route('super-admin.users.index') }}"
               class="px-6 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Annulla
            </a>
            <button type="submit"
                    class="px-6 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Crea Utente
            </button>
        </div>
    </form>
</div>

@push('scripts')
<script>
function toggleFields() {
    const userType = document.getElementById('user_type').value;
    const zoneField = document.getElementById('zone-field');
    const zoneRequired = document.getElementById('zone-required');
    const refereeFields = document.getElementById('referee-fields');
    const zoneSelect = document.getElementById('zone_id');

    // Reset
    zoneField.style.display = 'none';
    zoneRequired.style.display = 'none';
    refereeFields.style.display = 'none';
    zoneSelect.required = false;

    if (userType === 'zone_admin' || userType === 'referee') {
        zoneField.style.display = 'block';
        zoneRequired.style.display = 'inline';
        zoneSelect.required = true;
    }

    if (userType === 'referee') {
        refereeFields.style.display = 'block';
    }
}

function previewPhoto(input) {
    const preview = document.getElementById('photo-preview');

    if (input.files && input.files[0]) {
        const reader = new FileReader();

        reader.onload = function(e) {
            preview.src = e.target.result;
        }

        reader.readAsDataURL(input.files[0]);
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    toggleFields();
});
</script>
@endpush
@endsection
@extends('layouts.super-admin')

@section('title', 'Modifica Utente: ' . $user->name)

@section('content')
<div class="container mx-auto px-4 py-8 max-w-4xl">
    {{-- Header --}}
    <div class="mb-8">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">Modifica Utente</h1>
                <p class="mt-2 text-gray-600">Modifica le informazioni di: {{ $user->name }}</p>
            </div>
            <div class="flex space-x-4">
                <a href="{{ route('super-admin.users.show', $user) }}"
                   class="text-gray-600 hover:text-gray-900 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                    </svg>
                    Visualizza
                </a>
                <a href="{{ route('super-admin.users.index') }}"
                   class="text-gray-600 hover:text-gray-900 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    Torna all'elenco
                </a>
            </div>
        </div>
    </div>

    {{-- Warning for current user --}}
    @if($user->id === auth()->id())
    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
        <div class="flex">
            <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                </svg>
            </div>
            <div class="ml-3">
                <p class="text-sm text-yellow-700">
                    <strong>Attenzione:</strong> Stai modificando il tuo account.
                    Fai attenzione a non disattivare il tuo accesso.
                </p>
            </div>
        </div>
    </div>
    @endif

    {{-- Form --}}
    <form action="{{ route('super-admin.users.update', $user) }}" method="POST" enctype="multipart/form-data" class="space-y-6">
        @csrf
        @method('PUT')

        {{-- Basic Information --}}
        <div class="bg-white shadow-sm rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">Informazioni Base</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="col-span-2">
                    <label for="name" class="block text-sm font-medium text-gray-700">
                        Nome Completo <span class="text-red-500">*</span>
                    </label>
                    <input type="text" name="name" id="name"
                           value="{{ old('name', $user->name) }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('name') border-red-500 @enderror"
                           required>
                    @error('name')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700">
                        Email <span class="text-red-500">*</span>
                    </label>
                    <input type="email" name="email" id="email"
                           value="{{ old('email', $user->email) }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('email') border-red-500 @enderror"
                           required>
                    @error('email')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="codice_tessera" class="block text-sm font-medium text-gray-700">
                        Codice Tessera
                    </label>
                    <input type="text" name="codice_tessera" id="codice_tessera"
                           value="{{ old('codice_tessera', $user->codice_tessera) }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('codice_tessera') border-red-500 @enderror">
                    @error('codice_tessera')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700">
                        Nuova Password
                    </label>
                    <input type="password" name="password" id="password"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('password') border-red-500 @enderror">
                    <p class="mt-1 text-xs text-gray-500">Lascia vuoto per mantenere la password attuale</p>
                    @error('password')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="password_confirmation" class="block text-sm font-medium text-gray-700">
                        Conferma Nuova Password
                    </label>
                    <input type="password" name="password_confirmation" id="password_confirmation"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                </div>
            </div>
        </div>

        {{-- User Type and Zone --}}
        <div class="bg-white shadow-sm rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">Tipo Utente e Zona</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="user_type" class="block text-sm font-medium text-gray-700">
                        Tipo Utente <span class="text-red-500">*</span>
                    </label>
                    <select name="user_type" id="user_type"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('user_type') border-red-500 @enderror"
                            required onchange="toggleFields()"
                            {{ $user->id === auth()->id() ? 'disabled' : '' }}>
                        @foreach($userTypes as $value => $label)
                            <option value="{{ $value }}" {{ old('user_type', $user->user_type) === $value ? 'selected' : '' }}>
                                {{ $label }}
                            </option>
                        @endforeach
                    </select>
                    @if($user->id === auth()->id())
                        <input type="hidden" name="user_type" value="{{ $user->user_type }}">
                        <p class="mt-1 text-xs text-gray-500">Non puoi modificare il tuo tipo utente</p>
                    @endif
                    @error('user_type')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div id="zone-field" style="{{ old('user_type', $user->user_type) && old('user_type', $user->user_type) !== 'super_admin' && old('user_type', $user->user_type) !== 'national_admin' ? '' : 'display: none;' }}">
                    <label for="zone_id" class="block text-sm font-medium text-gray-700">
                        Zona <span class="text-red-500" id="zone-required" style="display: none;">*</span>
                    </label>
                    <select name="zone_id" id="zone_id"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('zone_id') border-red-500 @enderror">
                        <option value="">Seleziona zona</option>
                        @foreach($zones as $zone)
                            <option value="{{ $zone->id }}" {{ old('zone_id', $user->zone_id) == $zone->id ? 'selected' : '' }}>
                                {{ $zone->name }}
                            </option>
                        @endforeach
                    </select>
                    @error('zone_id')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>
            </div>

            <div id="referee-fields" class="mt-6" style="{{ old('user_type', $user->user_type) === 'referee' ? '' : 'display: none;' }}">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Informazioni Arbitro</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="livello_arbitro" class="block text-sm font-medium text-gray-700">
                            Livello Arbitro
                        </label>
                        <select name="livello_arbitro" id="livello_arbitro"
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            <option value="">Seleziona livello</option>
                            @foreach($refereeLevels as $value => $label)
                                <option value="{{ $value }}" {{ old('livello_arbitro', $user->livello_arbitro) === $value ? 'selected' : '' }}>
                                    {{ $label }}
                                </option>
                            @endforeach
                        </select>
                    </div>
                </div>
            </div>
        </div>

        {{-- Contact Information --}}
        <div class="bg-white shadow-sm rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">Informazioni di Contatto</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="telefono" class="block text-sm font-medium text-gray-700">
                        Telefono
                    </label>
                    <input type="tel" name="telefono" id="telefono"
                           value="{{ old('telefono', $user->telefono) }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('telefono') border-red-500 @enderror">
                    @error('telefono')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="data_nascita" class="block text-sm font-medium text-gray-700">
                        Data di Nascita
                    </label>
                    <input type="date" name="data_nascita" id="data_nascita"
                           value="{{ old('data_nascita', $user->data_nascita ? $user->data_nascita->format('Y-m-d') : '') }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('data_nascita') border-red-500 @enderror">
                    @error('data_nascita')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div class="col-span-2">
                    <label for="indirizzo" class="block text-sm font-medium text-gray-700">
                        Indirizzo
                    </label>
                    <input type="text" name="indirizzo" id="indirizzo"
                           value="{{ old('indirizzo', $user->indirizzo) }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('indirizzo') border-red-500 @enderror">
                    @error('indirizzo')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="citta" class="block text-sm font-medium text-gray-700">
                        Città
                    </label>
                    <input type="text" name="citta" id="citta"
                           value="{{ old('citta', $user->citta) }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('citta') border-red-500 @enderror">
                    @error('citta')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="cap" class="block text-sm font-medium text-gray-700">
                        CAP
                    </label>
                    <input type="text" name="cap" id="cap"
                           value="{{ old('cap', $user->cap) }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('cap') border-red-500 @enderror">
                    @error('cap')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>
            </div>
        </div>

        {{-- Profile Photo --}}
        <div class="bg-white shadow-sm rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">Foto Profilo</h2>

            <div>
                <label for="profile_photo" class="block text-sm font-medium text-gray-700">
                    Foto Profilo
                </label>
                <div class="mt-1 flex items-center space-x-4">
                    <div class="flex-shrink-0">
                        @if($user->profile_photo_path)
                            <img id="photo-preview" class="h-20 w-20 rounded-full object-cover"
                                 src="{{ Storage::url($user->profile_photo_path) }}"
                                 alt="Foto profilo">
                        @else
                            <img id="photo-preview" class="h-20 w-20 rounded-full object-cover bg-gray-200"
                                 src="data:image/svg+xml,%3csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100' height='100' fill='%23e5e7eb'/%3e%3ctext x='50%25' y='50%25' font-size='16' text-anchor='middle' dy='.3em' fill='%236b7280'%3e{{ substr($user->name, 0, 1) }}%3c/text%3e%3c/svg%3e"
                                 alt="Preview">
                        @endif
                    </div>
                    <div class="flex-1">
                        <input type="file" name="profile_photo" id="profile_photo"
                               accept="image/*"
                               class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"
                               onchange="previewPhoto(this)">
                        <p class="mt-1 text-sm text-gray-500">PNG, JPG, JPEG fino a 2MB</p>
                    </div>
                    @if($user->profile_photo_path)
                        <button type="button" onclick="removePhoto()"
                                class="text-red-600 hover:text-red-800 text-sm">
                            Rimuovi
                        </button>
                        <input type="hidden" name="remove_photo" id="remove_photo" value="0">
                    @endif
                </div>
                @error('profile_photo')
                    <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                @enderror
            </div>
        </div>

        {{-- Status --}}
        <div class="bg-white shadow-sm rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">Stato</h2>

            <div class="space-y-4">
                <div class="flex items-center">
                    <input type="checkbox" name="is_active" id="is_active" value="1"
                           {{ old('is_active', $user->is_active) ? 'checked' : '' }}
                           {{ $user->id === auth()->id() ? 'disabled' : '' }}
                           class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                    <label for="is_active" class="ml-2 text-sm text-gray-700">
                        Utente Attivo
                    </label>
                    @if($user->id === auth()->id())
                        <input type="hidden" name="is_active" value="1">
                    @endif
                </div>
                @if($user->id === auth()->id())
                    <p class="text-xs text-gray-500">Non puoi disattivare il tuo account</p>
                @else
                    <p class="text-xs text-gray-500">Gli utenti non attivi non possono accedere al sistema</p>
                @endif
            </div>

            {{-- Last activity info --}}
            <div class="mt-4 pt-4 border-t border-gray-200">
                <dl class="grid grid-cols-1 gap-x-4 gap-y-2 sm:grid-cols-2">
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Ultimo accesso</dt>
                        <dd class="text-sm text-gray-900">
                            {{ $user->last_login_at ? $user->last_login_at->format('d/m/Y H:i') : 'Mai' }}
                        </dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Registrato il</dt>
                        <dd class="text-sm text-gray-900">
                            {{ $user->created_at->format('d/m/Y H:i') }}
                        </dd>
                    </div>
                </dl>
            </div>
        </div>

        {{-- Actions --}}
        <div class="flex justify-between">
            <div>
                @if($user->id !== auth()->id())
                <button type="button" onclick="confirmDelete()"
                        class="px-4 py-2 border border-red-300 rounded-md shadow-sm text-sm font-medium text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                    <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                    Elimina Utente
                </button>
                @endif
            </div>
            <div class="flex space-x-4">
                <a href="{{ route('super-admin.users.index') }}"
                   class="px-6 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Annulla
                </a>
                <button type="submit"
                        class="px-6 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Salva Modifiche
                </button>
            </div>
        </div>
    </form>
</div>

{{-- Delete Form (hidden) --}}
<form id="delete-form" action="{{ route('super-admin.users.destroy', $user) }}" method="POST" style="display: none;">
    @csrf
    @method('DELETE')
</form>

@push('scripts')
<script>
function toggleFields() {
    const userType = document.getElementById('user_type').value;
    const zoneField = document.getElementById('zone-field');
    const zoneRequired = document.getElementById('zone-required');
    const refereeFields = document.getElementById('referee-fields');
    const zoneSelect = document.getElementById('zone_id');

    // Reset
    zoneField.style.display = 'none';
    zoneRequired.style.display = 'none';
    refereeFields.style.display = 'none';
    zoneSelect.required = false;

    if (userType === 'zone_admin' || userType === 'referee') {
        zoneField.style.display = 'block';
        zoneRequired.style.display = 'inline';
        zoneSelect.required = true;
    }

    if (userType === 'referee') {
        refereeFields.style.display = 'block';
    }
}

function previewPhoto(input) {
    const preview = document.getElementById('photo-preview');

    if (input.files && input.files[0]) {
        const reader = new FileReader();

        reader.onload = function(e) {
            preview.src = e.target.result;
        }

        reader.readAsDataURL(input.files[0]);

        // Reset remove photo flag
        const removePhotoInput = document.getElementById('remove_photo');
        if (removePhotoInput) {
            removePhotoInput.value = '0';
        }
    }
}

function removePhoto() {
    if (confirm('Sei sicuro di voler rimuovere la foto profilo?')) {
        document.getElementById('remove_photo').value = '1';
        document.getElementById('photo-preview').src = "data:image/svg+xml,%3csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100' height='100' fill='%23e5e7eb'/%3e%3ctext x='50%25' y='50%25' font-size='16' text-anchor='middle' dy='.3em' fill='%236b7280'%3e{{ substr($user->name, 0, 1) }}%3c/text%3e%3c/svg%3e";
        document.getElementById('profile_photo').value = '';
    }
}

function confirmDelete() {
    if (confirm('Sei sicuro di voler eliminare questo utente? Questa azione è irreversibile.')) {
        document.getElementById('delete-form').submit();
    }
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    toggleFields();
});
</script>
@endpush
@endsection
@extends('layouts.super-admin')

@section('title', 'Gestione Utenti')

@section('content')
<div class="container mx-auto px-4 py-8">
    {{-- Header --}}
    <div class="flex justify-between items-center mb-8">
        <div>
            <h1 class="text-3xl font-bold text-gray-900">Gestione Utenti</h1>
            <p class="mt-2 text-gray-600">Gestisci tutti gli utenti del sistema</p>
        </div>
        <div class="flex space-x-4">
            <a href="{{ route('super-admin.users.create') }}"
               class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition duration-200 flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                Nuovo Utente
            </a>
        </div>
    </div>

    {{-- Filters --}}
    <div class="bg-white rounded-lg shadow p-6 mb-6">
        <form method="GET" action="{{ route('super-admin.users.index') }}" class="grid grid-cols-1 md:grid-cols-5 gap-4">
            <div>
                <label for="search" class="block text-sm font-medium text-gray-700">Cerca</label>
                <input type="text" name="search" id="search"
                       value="{{ request('search') }}"
                       placeholder="Nome, email o tessera..."
                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
            </div>

            <div>
                <label for="user_type" class="block text-sm font-medium text-gray-700">Tipo Utente</label>
                <select name="user_type" id="user_type"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                    <option value="">Tutti</option>
                    <option value="super_admin" {{ request('user_type') === 'super_admin' ? 'selected' : '' }}>Super Admin</option>
                    <option value="national_admin" {{ request('user_type') === 'national_admin' ? 'selected' : '' }}>Admin Nazionale</option>
                    <option value="zone_admin" {{ request('user_type') === 'zone_admin' ? 'selected' : '' }}>Admin Zona</option>
                    <option value="referee" {{ request('user_type') === 'referee' ? 'selected' : '' }}>Arbitro</option>
                </select>
            </div>

            <div>
                <label for="zone_id" class="block text-sm font-medium text-gray-700">Zona</label>
                <select name="zone_id" id="zone_id"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                    <option value="">Tutte le Zone</option>
                    @foreach($zones as $zone)
                        <option value="{{ $zone->id }}" {{ request('zone_id') == $zone->id ? 'selected' : '' }}>
                            {{ $zone->name }}
                        </option>
                    @endforeach
                </select>
            </div>

            <div>
                <label for="is_active" class="block text-sm font-medium text-gray-700">Stato</label>
                <select name="is_active" id="is_active"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                    <option value="">Tutti</option>
                    <option value="1" {{ request('is_active') === '1' ? 'selected' : '' }}>Attivi</option>
                    <option value="0" {{ request('is_active') === '0' ? 'selected' : '' }}>Non Attivi</option>
                </select>
            </div>

            <div class="flex items-end space-x-2">
                <button type="submit"
                        class="flex-1 bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition duration-200">
                    Filtra
                </button>
                <a href="{{ route('super-admin.users.index') }}"
                   class="bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400 transition duration-200">
                    Reset
                </a>
            </div>
        </form>
    </div>

    {{-- Bulk Actions --}}
    <div class="bg-white rounded-lg shadow mb-6" id="bulk-actions" style="display: none;">
        <div class="p-4 border-b">
            <div class="flex items-center justify-between">
                <span class="text-sm text-gray-600">
                    <span id="selected-count">0</span> utenti selezionati
                </span>
                <div class="flex space-x-2">
                    <button onclick="bulkAction('activate')"
                            class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                        Attiva
                    </button>
                    <button onclick="bulkAction('deactivate')"
                            class="bg-yellow-600 text-white px-3 py-1 rounded text-sm hover:bg-yellow-700">
                        Disattiva
                    </button>
                    <button onclick="bulkAction('delete')"
                            class="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700">
                        Elimina
                    </button>
                </div>
            </div>
        </div>
    </div>

    {{-- Users Table --}}
    <div class="bg-white shadow-xl rounded-lg overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        <input type="checkbox" id="select-all" class="rounded border-gray-300 text-indigo-600">
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Utente
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Tipo / Zona
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Contatti
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Statistiche
                    </th>
                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Stato
                    </th>
                    <th scope="col" class="relative px-6 py-3">
                        <span class="sr-only">Azioni</span>
                    </th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                @forelse($users as $user)
                <tr class="hover:bg-gray-50 transition-colors duration-150">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <input type="checkbox" value="{{ $user->id }}" class="user-checkbox rounded border-gray-300 text-indigo-600">
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 h-10 w-10">
                                @if($user->profile_photo_path)
                                    <img class="h-10 w-10 rounded-full object-cover" src="{{ Storage::url($user->profile_photo_path) }}" alt="">
                                @else
                                    <div class="h-10 w-10 rounded-full bg-indigo-500 flex items-center justify-center">
                                        <span class="text-white font-medium">{{ substr($user->name, 0, 1) }}</span>
                                    </div>
                                @endif
                            </div>
                            <div class="ml-4">
                                <div class="text-sm font-medium text-gray-900">{{ $user->name }}</div>
                                <div class="text-sm text-gray-500">{{ $user->email }}</div>
                                @if($user->codice_tessera)
                                    <div class="text-xs text-gray-400">Tessera: {{ $user->codice_tessera }}</div>
                                @endif
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div>
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full
                                @switch($user->user_type)
                                    @case('super_admin') bg-purple-100 text-purple-800 @break
                                    @case('national_admin') bg-blue-100 text-blue-800 @break
                                    @case('zone_admin') bg-green-100 text-green-800 @break
                                    @case('referee') bg-gray-100 text-gray-800 @break
                                @endswitch">
                                @switch($user->user_type)
                                    @case('super_admin') Super Admin @break
                                    @case('national_admin') Admin Nazionale @break
                                    @case('zone_admin') Admin Zona @break
                                    @case('referee') Arbitro @break
                                @endswitch
                            </span>
                        </div>
                        @if($user->zone)
                            <div class="text-xs text-gray-500 mt-1">{{ $user->zone->name }}</div>
                        @endif
                        @if($user->livello_arbitro && $user->user_type === 'referee')
                            <div class="text-xs text-gray-400 mt-1">{{ ucfirst($user->livello_arbitro) }}</div>
                        @endif
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        @if($user->telefono)
                            <div>📞 {{ $user->telefono }}</div>
                        @endif
                        @if($user->citta)
                            <div>📍 {{ $user->citta }}</div>
                        @endif
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        @if($user->user_type === 'referee')
                            <div>Tornei: {{ $user->tournaments_count ?? 0 }}</div>
                            <div>Assegnazioni: {{ $user->assignments_count ?? 0 }}</div>
                        @elseif(in_array($user->user_type, ['zone_admin', 'national_admin']))
                            <div>Tornei creati: {{ $user->tournaments_count ?? 0 }}</div>
                        @endif
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                        <button onclick="toggleActive({{ $user->id }})"
                                class="relative inline-flex items-center h-6 rounded-full w-11 transition-colors duration-200 focus:outline-none
                                {{ $user->is_active ? 'bg-green-500' : 'bg-gray-300' }}">
                            <span class="sr-only">Attiva/Disattiva</span>
                            <span class="inline-block w-4 h-4 transform transition-transform duration-200 bg-white rounded-full shadow
                                {{ $user->is_active ? 'translate-x-6' : 'translate-x-1' }}"></span>
                        </button>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <div class="flex items-center justify-end space-x-2">
                            <a href="{{ route('super-admin.users.show', $user) }}"
                               class="text-gray-600 hover:text-gray-900" title="Visualizza">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </a>
                            <a href="{{ route('super-admin.users.edit', $user) }}"
                               class="text-indigo-600 hover:text-indigo-900" title="Modifica">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                            </a>
                            <button onclick="resetPassword({{ $user->id }})"
                                    class="text-yellow-600 hover:text-yellow-900" title="Reset Password">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"></path>
                                </svg>
                            </button>
                            @if($user->id !== auth()->id())
                            <button onclick="deleteUser({{ $user->id }})"
                                    class="text-red-600 hover:text-red-900" title="Elimina">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                            @endif
                        </div>
                    </td>
                </tr>
                @empty
                <tr>
                    <td colspan="7" class="px-6 py-12 text-center text-gray-500">
                        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                        <p class="mt-2">Nessun utente trovato</p>
                    </td>
                </tr>
                @endforelse
            </tbody>
        </table>
    </div>

    {{-- Pagination --}}
    @if($users->hasPages())
        <div class="mt-6">
            {{ $users->appends(request()->query())->links() }}
        </div>
    @endif
</div>

{{-- Hidden form for bulk actions --}}
<form id="bulk-form" method="POST" action="{{ route('super-admin.users.bulk-action') }}" style="display: none;">
    @csrf
    <input type="hidden" name="action" id="bulk-action">
    <input type="hidden" name="user_ids" id="bulk-user-ids">
</form>

{{-- Hidden forms for individual actions --}}
<form id="delete-form" method="POST" style="display: none;">
    @csrf
    @method('DELETE')
</form>

@push('scripts')
<script>
// Select all functionality
document.getElementById('select-all').addEventListener('change', function() {
    const checkboxes = document.querySelectorAll('.user-checkbox');
    checkboxes.forEach(checkbox => {
        checkbox.checked = this.checked;
    });
    updateBulkActions();
});

// Individual checkbox functionality
document.querySelectorAll('.user-checkbox').forEach(checkbox => {
    checkbox.addEventListener('change', updateBulkActions);
});

function updateBulkActions() {
    const checkedBoxes = document.querySelectorAll('.user-checkbox:checked');
    const bulkActions = document.getElementById('bulk-actions');
    const selectedCount = document.getElementById('selected-count');

    if (checkedBoxes.length > 0) {
        bulkActions.style.display = 'block';
        selectedCount.textContent = checkedBoxes.length;
    } else {
        bulkActions.style.display = 'none';
    }
}

// Bulk actions
function bulkAction(action) {
    const checkedBoxes = document.querySelectorAll('.user-checkbox:checked');
    if (checkedBoxes.length === 0) {
        alert('Seleziona almeno un utente');
        return;
    }

    const userIds = Array.from(checkedBoxes).map(cb => cb.value);
    const actionText = {
        'activate': 'attivare',
        'deactivate': 'disattivare',
        'delete': 'eliminare'
    };

    if (confirm(`Sei sicuro di voler ${actionText[action]} ${userIds.length} utenti?`)) {
        document.getElementById('bulk-action').value = action;
        document.getElementById('bulk-user-ids').value = JSON.stringify(userIds);
        document.getElementById('bulk-form').submit();
    }
}

// Toggle active status
function toggleActive(userId) {
    fetch(`/super-admin/users/${userId}/toggle-active`, {
        method: 'POST',
        headers: {
            'X-CSRF-TOKEN': '{{ csrf_token() }}',
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert('Errore: ' + data.message);
        }
    });
}

// Reset password
function resetPassword(userId) {
    if (confirm('Sei sicuro di voler reimpostare la password di questo utente?')) {
        fetch(`/super-admin/users/${userId}/reset-password`, {
            method: 'POST',
            headers: {
                'X-CSRF-TOKEN': '{{ csrf_token() }}',
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            alert(data.message);
        });
    }
}

// Delete user
function deleteUser(userId) {
    if (confirm('Sei sicuro di voler eliminare questo utente? Questa azione è irreversibile.')) {
        const form = document.getElementById('delete-form');
        form.action = `/super-admin/users/${userId}`;
        form.submit();
    }
}
</script>
@endpush
@endsection
@extends('layouts.super-admin')

@section('title', 'Utente: ' . $user->name)

@section('content')
<div class="container mx-auto px-4 py-8 max-w-6xl">
    {{-- Header --}}
    <div class="mb-8">
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <div class="flex-shrink-0 mr-4">
                    @if($user->profile_photo_path)
                        <img class="h-16 w-16 rounded-full object-cover" src="{{ Storage::url($user->profile_photo_path) }}" alt="">
                    @else
                        <div class="h-16 w-16 rounded-full bg-indigo-500 flex items-center justify-center">
                            <span class="text-white font-medium text-xl">{{ substr($user->name, 0, 1) }}</span>
                        </div>
                    @endif
                </div>
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">{{ $user->name }}</h1>
                    <p class="mt-1 text-gray-600">{{ $user->email }}</p>
                    @if($user->codice_tessera)
                        <p class="text-sm text-gray-500">Tessera: {{ $user->codice_tessera }}</p>
                    @endif
                </div>
            </div>
            <div class="flex space-x-4">
                <a href="{{ route('super-admin.users.edit', $user) }}"
                   class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition duration-200 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                    Modifica
                </a>
                <a href="{{ route('super-admin.users.index') }}"
                   class="text-gray-600 hover:text-gray-900 flex items-center px-4 py-2">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    Torna all'elenco
                </a>
            </div>
        </div>
    </div>

    {{-- Status Badges --}}
    <div class="mb-6 flex items-center space-x-4">
        <span class="px-3 py-1 inline-flex text-sm leading-5 font-semibold rounded-full
            {{ $user->is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800' }}">
            {{ $user->is_active ? 'Attivo' : 'Non Attivo' }}
        </span>
        <span class="px-3 py-1 inline-flex text-sm leading-5 font-semibold rounded-full
            @switch($user->user_type)
                @case('super_admin') bg-purple-100 text-purple-800 @break
                @case('national_admin') bg-blue-100 text-blue-800 @break
                @case('zone_admin') bg-green-100 text-green-800 @break
                @case('referee') bg-gray-100 text-gray-800 @break
            @endswitch">
            @switch($user->user_type)
                @case('super_admin') Super Admin @break
                @case('national_admin') Admin Nazionale @break
                @case('zone_admin') Admin Zona @break
                @case('referee') Arbitro @break
            @endswitch
        </span>
        @if($user->zone)
            <span class="px-3 py-1 inline-flex text-sm leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">
                {{ $user->zone->name }}
            </span>
        @endif
        @if($user->livello_arbitro && $user->user_type === 'referee')
            <span class="px-3 py-1 inline-flex text-sm leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                {{ ucfirst($user->livello_arbitro) }}
            </span>
        @endif
    </div>

    {{-- Statistics Cards --}}
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-2 bg-blue-100 rounded-lg">
                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Tornei</p>
                    <p class="text-2xl font-semibold text-gray-900">{{ $stats['tournaments_count'] }}</p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-2 bg-green-100 rounded-lg">
                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Assegnazioni</p>
                    <p class="text-2xl font-semibold text-gray-900">{{ $stats['assignments_count'] }}</p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-2 bg-yellow-100 rounded-lg">
                    <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">In Attesa</p>
                    <p class="text-2xl font-semibold text-gray-900">{{ $stats['pending_assignments'] }}</p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-2 bg-purple-100 rounded-lg">
                    <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Completate</p>
                    <p class="text-2xl font-semibold text-gray-900">{{ $stats['completed_assignments'] }}</p>
                </div>
            </div>
        </div>
    </div>

    {{-- User Details Grid --}}
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
        {{-- Personal Information --}}
        <div class="lg:col-span-2">
            <div class="bg-white shadow rounded-lg p-6">
                <h2 class="text-lg font-medium text-gray-900 mb-4">Informazioni Personali</h2>
                <dl class="grid grid-cols-1 gap-x-4 gap-y-4 sm:grid-cols-2">
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Nome Completo</dt>
                        <dd class="mt-1 text-sm text-gray-900">{{ $user->name }}</dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Email</dt>
                        <dd class="mt-1 text-sm text-gray-900">
                            <a href="mailto:{{ $user->email }}" class="text-indigo-600 hover:text-indigo-500">
                                {{ $user->email }}
                            </a>
                        </dd>
                    </div>
                    @if($user->telefono)
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Telefono</dt>
                        <dd class="mt-1 text-sm text-gray-900">
                            <a href="tel:{{ $user->telefono }}" class="text-indigo-600 hover:text-indigo-500">
                                {{ $user->telefono }}
                            </a>
                        </dd>
                    </div>
                    @endif
                    @if($user->data_nascita)
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Data di Nascita</dt>
                        <dd class="mt-1 text-sm text-gray-900">
                            {{ $user->data_nascita->format('d/m/Y') }}
                            <span class="text-gray-500">({{ $user->data_nascita->age }} anni)</span>
                        </dd>
                    </div>
                    @endif
                    @if($user->indirizzo)
                    <div class="sm:col-span-2">
                        <dt class="text-sm font-medium text-gray-500">Indirizzo</dt>
                        <dd class="mt-1 text-sm text-gray-900">
                            {{ $user->indirizzo }}
                            @if($user->citta), {{ $user->citta }}@endif
                            @if($user->cap) {{ $user->cap }}@endif
                        </dd>
                    </div>
                    @endif
                    @if($user->codice_tessera)
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Codice Tessera</dt>
                        <dd class="mt-1 text-sm text-gray-900">{{ $user->codice_tessera }}</dd>
                    </div>
                    @endif
                </dl>
            </div>
        </div>

        {{-- Account Information --}}
        <div>
            <div class="bg-white shadow rounded-lg p-6">
                <h2 class="text-lg font-medium text-gray-900 mb-4">Informazioni Account</h2>
                <dl class="space-y-4">
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Tipo Utente</dt>
                        <dd class="mt-1 text-sm text-gray-900">
                            @switch($user->user_type)
                                @case('super_admin') Super Admin @break
                                @case('national_admin') Admin Nazionale (CRC) @break
                                @case('zone_admin') Admin Zona @break
                                @case('referee') Arbitro @break
                            @endswitch
                        </dd>
                    </div>
                    @if($user->zone)
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Zona</dt>
                        <dd class="mt-1 text-sm text-gray-900">{{ $user->zone->name }}</dd>
                    </div>
                    @endif
                    @if($user->livello_arbitro && $user->user_type === 'referee')
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Livello Arbitro</dt>
                        <dd class="mt-1 text-sm text-gray-900">{{ config('referee.referee_levels')[$user->livello_arbitro] ?? ucfirst($user->livello_arbitro) }}</dd>
                    </div>
                    @endif
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Stato</dt>
                        <dd class="mt-1">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full
                                {{ $user->is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800' }}">
                                {{ $user->is_active ? 'Attivo' : 'Non Attivo' }}
                            </span>
                        </dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Ultimo Accesso</dt>
                        <dd class="mt-1 text-sm text-gray-900">
                            {{ $user->last_login_at ? $user->last_login_at->format('d/m/Y H:i') : 'Mai' }}
                        </dd>
                    </div>
                    <div>
                        <dt class="text-sm font-medium text-gray-500">Registrato il</dt>
                        <dd class="mt-1 text-sm text-gray-900">{{ $user->created_at->format('d/m/Y H:i') }}</dd>
                    </div>
                </dl>
            </div>
        </div>
    </div>

    {{-- Recent Activity --}}
    @if($user->user_type === 'referee' && $user->assignments->count() > 0)
    <div class="bg-white shadow rounded-lg overflow-hidden mb-8">
        <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-lg font-medium text-gray-900">Assegnazioni Recenti</h2>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Torneo
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Date
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Stato
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Assegnato il
                        </th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    @foreach($user->assignments()->with('tournament')->latest()->limit(10)->get() as $assignment)
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900">
                                {{ $assignment->tournament->name }}
                            </div>
                            <div class="text-sm text-gray-500">
                                {{ $assignment->tournament->club->name ?? 'N/A' }}
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {{ \Carbon\Carbon::parse($assignment->tournament->start_date)->format('d/m/Y') }} -
                            {{ \Carbon\Carbon::parse($assignment->tournament->end_date)->format('d/m/Y') }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full
                                @switch($assignment->status)
                                    @case('pending') bg-yellow-100 text-yellow-800 @break
                                    @case('accepted') bg-green-100 text-green-800 @break
                                    @case('rejected') bg-red-100 text-red-800 @break
                                    @default bg-gray-100 text-gray-800
                                @endswitch">
                                @switch($assignment->status)
                                    @case('pending') In Attesa @break
                                    @case('accepted') Accettato @break
                                    @case('rejected') Rifiutato @break
                                    @default {{ ucfirst($assignment->status) }}
                                @endswitch
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {{ $assignment->created_at->format('d/m/Y') }}
                        </td>
                    </tr>
                    @endforeach
                </tbody>
            </table>
        </div>
    </div>
    @endif

    {{-- Tournaments Created (for admins) --}}
    @if(in_array($user->user_type, ['zone_admin', 'national_admin']) && $user->tournaments->count() > 0)
    <div class="bg-white shadow rounded-lg overflow-hidden">
        <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-lg font-medium text-gray-900">Tornei Creati</h2>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Nome Torneo
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Categoria
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Date
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Stato
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Creato il
                        </th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    @foreach($user->tournaments()->with(['category', 'club'])->latest()->limit(10)->get() as $tournament)
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900">
                                {{ $tournament->name }}
                            </div>
                            <div class="text-sm text-gray-500">
                                {{ $tournament->club->name ?? 'N/A' }}
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {{ $tournament->category->name ?? 'N/A' }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {{ \Carbon\Carbon::parse($tournament->start_date)->format('d/m/Y') }} -
                            {{ \Carbon\Carbon::parse($tournament->end_date)->format('d/m/Y') }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full
                                @switch($tournament->status)
                                    @case('draft') bg-gray-100 text-gray-800 @break
                                    @case('open') bg-green-100 text-green-800 @break
                                    @case('closed') bg-yellow-100 text-yellow-800 @break
                                    @case('assigned') bg-blue-100 text-blue-800 @break
                                    @case('completed') bg-purple-100 text-purple-800 @break
                                    @default bg-gray-100 text-gray-800
                                @endswitch">
                                {{ ucfirst($tournament->status) }}
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {{ $tournament->created_at->format('d/m/Y') }}
                        </td>
                    </tr>
                    @endforeach
                </tbody>
            </table>
        </div>
    </div>
    @endif

    {{-- Quick Actions --}}
    <div class="mt-8 bg-gray-50 rounded-lg p-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4">Azioni Rapide</h3>
        <div class="flex flex-wrap gap-4">
            <button onclick="resetPassword({{ $user->id }})"
                    class="bg-yellow-600 text-white px-4 py-2 rounded-lg hover:bg-yellow-700 transition duration-200 flex items-center">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"></path>
                </svg>
                Reset Password
            </button>

            @if($user->user_type === 'referee')
            <a href="{{ route('admin.referees.show', $user) }}"
               class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200 flex items-center">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
                Vedi Profilo Arbitro
            </a>
            @endif

            <button onclick="toggleActive({{ $user->id }})"
                    class="{{ $user->is_active ? 'bg-red-600 hover:bg-red-700' : 'bg-green-600 hover:bg-green-700' }} text-white px-4 py-2 rounded-lg transition duration-200 flex items-center"
                    {{ $user->id === auth()->id() ? 'disabled' : '' }}>
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z"></path>
                </svg>
                {{ $user->is_active ? 'Disattiva' : 'Attiva' }}
            </button>
        </div>
    </div>
</div>

@push('scripts')
<script>
function resetPassword(userId) {
    if (confirm('Sei sicuro di voler reimpostare la password di questo utente?')) {
        fetch(`/super-admin/users/${userId}/reset-password`, {
            method: 'POST',
            headers: {
                'X-CSRF-TOKEN': '{{ csrf_token() }}',
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            alert(data.message);
        });
    }
}

function toggleActive(userId) {
    fetch(`/super-admin/users/${userId}/toggle-active`, {
        method: 'POST',
        headers: {
            'X-CSRF-TOKEN': '{{ csrf_token() }}',
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        } else {
            alert('Errore: ' + data.message);
        }
    });
}
</script>
@endpush
@endsection
@extends('layouts.super-admin')

@section('title', 'Nuova Zona')

@section('content')
<div class="container mx-auto px-4 py-8 max-w-4xl">
    {{-- Header --}}
    <div class="mb-8">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">Nuova Zona</h1>
                <p class="mt-2 text-gray-600">Crea una nuova zona territoriale</p>
            </div>
            <a href="{{ route('super-admin.zones.index') }}"
               class="text-gray-600 hover:text-gray-900 flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
                Torna all'elenco
            </a>
        </div>
    </div>

    {{-- Form --}}
    <form action="{{ route('super-admin.zones.store') }}" method="POST" class="space-y-6">
        @csrf

        {{-- Basic Information --}}
        <div class="bg-white shadow-sm rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">Informazioni Base</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700">
                        Nome Zona <span class="text-red-500">*</span>
                    </label>
                    <input type="text" name="name" id="name"
                           value="{{ old('name') }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('name') border-red-500 @enderror"
                           required>
                    @error('name')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="code" class="block text-sm font-medium text-gray-700">
                        Codice Zona <span class="text-red-500">*</span>
                    </label>
                    <input type="text" name="code" id="code"
                           value="{{ old('code') }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm uppercase @error('code') border-red-500 @enderror"
                           pattern="[A-Za-z0-9_-]+"
                           title="Solo lettere, numeri, trattini e underscore"
                           required>
                    <p class="mt-1 text-xs text-gray-500">Es: CAM, LOM, VEN, SIC</p>
                    @error('code')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="region" class="block text-sm font-medium text-gray-700">
                        Regione <span class="text-red-500">*</span>
                    </label>
                    <select name="region" id="region"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('region') border-red-500 @enderror"
                            required>
                        <option value="">Seleziona regione</option>
                        <option value="Abruzzo" {{ old('region') === 'Abruzzo' ? 'selected' : '' }}>Abruzzo</option>
                        <option value="Basilicata" {{ old('region') === 'Basilicata' ? 'selected' : '' }}>Basilicata</option>
                        <option value="Calabria" {{ old('region') === 'Calabria' ? 'selected' : '' }}>Calabria</option>
                        <option value="Campania" {{ old('region') === 'Campania' ? 'selected' : '' }}>Campania</option>
                        <option value="Emilia-Romagna" {{ old('region') === 'Emilia-Romagna' ? 'selected' : '' }}>Emilia-Romagna</option>
                        <option value="Friuli-Venezia Giulia" {{ old('region') === 'Friuli-Venezia Giulia' ? 'selected' : '' }}>Friuli-Venezia Giulia</option>
                        <option value="Lazio" {{ old('region') === 'Lazio' ? 'selected' : '' }}>Lazio</option>
                        <option value="Liguria" {{ old('region') === 'Liguria' ? 'selected' : '' }}>Liguria</option>
                        <option value="Lombardia" {{ old('region') === 'Lombardia' ? 'selected' : '' }}>Lombardia</option>
                        <option value="Marche" {{ old('region') === 'Marche' ? 'selected' : '' }}>Marche</option>
                        <option value="Molise" {{ old('region') === 'Molise' ? 'selected' : '' }}>Molise</option>
                        <option value="Piemonte" {{ old('region') === 'Piemonte' ? 'selected' : '' }}>Piemonte</option>
                        <option value="Puglia" {{ old('region') === 'Puglia' ? 'selected' : '' }}>Puglia</option>
                        <option value="Sardegna" {{ old('region') === 'Sardegna' ? 'selected' : '' }}>Sardegna</option>
                        <option value="Sicilia" {{ old('region') === 'Sicilia' ? 'selected' : '' }}>Sicilia</option>
                        <option value="Toscana" {{ old('region') === 'Toscana' ? 'selected' : '' }}>Toscana</option>
                        <option value="Trentino-Alto Adige" {{ old('region') === 'Trentino-Alto Adige' ? 'selected' : '' }}>Trentino-Alto Adige</option>
                        <option value="Umbria" {{ old('region') === 'Umbria' ? 'selected' : '' }}>Umbria</option>
                        <option value="Valle d'Aosta" {{ old('region') === "Valle d'Aosta" ? 'selected' : '' }}>Valle d'Aosta</option>
                        <option value="Veneto" {{ old('region') === 'Veneto' ? 'selected' : '' }}>Veneto</option>
                    </select>
                    @error('region')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="sort_order" class="block text-sm font-medium text-gray-700">
                        Ordine Visualizzazione
                    </label>
                    <input type="number" name="sort_order" id="sort_order"
                           value="{{ old('sort_order', 0) }}"
                           min="0"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('sort_order') border-red-500 @enderror">
                    <p class="mt-1 text-xs text-gray-500">Ordine crescente (0 = primo)</p>
                    @error('sort_order')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div class="col-span-2">
                    <label for="description" class="block text-sm font-medium text-gray-700">
                        Descrizione
                    </label>
                    <textarea name="description" id="description" rows="3"
                              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('description') border-red-500 @enderror">{{ old('description') }}</textarea>
                    @error('description')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>
            </div>
        </div>

        {{-- Contact Information --}}
        <div class="bg-white shadow-sm rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">Informazioni di Contatto</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="contact_email" class="block text-sm font-medium text-gray-700">
                        Email di Contatto
                    </label>
                    <input type="email" name="contact_email" id="contact_email"
                           value="{{ old('contact_email') }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('contact_email') border-red-500 @enderror">
                    @error('contact_email')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="contact_phone" class="block text-sm font-medium text-gray-700">
                        Telefono di Contatto
                    </label>
                    <input type="tel" name="contact_phone" id="contact_phone"
                           value="{{ old('contact_phone') }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('contact_phone') border-red-500 @enderror">
                    @error('contact_phone')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div class="col-span-2">
                    <label for="address" class="block text-sm font-medium text-gray-700">
                        Indirizzo Sede
                    </label>
                    <input type="text" name="address" id="address"
                           value="{{ old('address') }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('address') border-red-500 @enderror">
                    @error('address')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="city" class="block text-sm font-medium text-gray-700">
                        Città
                    </label>
                    <input type="text" name="city" id="city"
                           value="{{ old('city') }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('city') border-red-500 @enderror">
                    @error('city')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="postal_code" class="block text-sm font-medium text-gray-700">
                        CAP
                    </label>
                    <input type="text" name="postal_code" id="postal_code"
                           value="{{ old('postal_code') }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('postal_code') border-red-500 @enderror">
                    @error('postal_code')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div class="col-span-2">
                    <label for="website" class="block text-sm font-medium text-gray-700">
                        Sito Web
                    </label>
                    <input type="url" name="website" id="website"
                           value="{{ old('website') }}"
                           placeholder="https://www.esempio.it"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('website') border-red-500 @enderror">
                    @error('website')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>
            </div>
        </div>

        {{-- Administrator Assignment --}}
        <div class="bg-white shadow-sm rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">Amministratore Zona</h2>

            <div>
                <label for="admin_id" class="block text-sm font-medium text-gray-700">
                    Assegna Amministratore
                </label>
                <select name="admin_id" id="admin_id"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('admin_id') border-red-500 @enderror">
                    <option value="">Seleziona un amministratore (opzionale)</option>
                    @foreach($admins as $admin)
                        <option value="{{ $admin->id }}" {{ old('admin_id') == $admin->id ? 'selected' : '' }}>
                            {{ $admin->name }} ({{ $admin->email }})
                        </option>
                    @endforeach
                </select>
                <p class="mt-1 text-xs text-gray-500">
                    Solo amministratori zona non ancora assegnati ad altre zone.
                    Puoi creare l'amministratore successivamente se necessario.
                </p>
                @error('admin_id')
                    <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                @enderror
            </div>
        </div>

        {{-- Advanced Settings --}}
        <div class="bg-white shadow-sm rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">Impostazioni Avanzate</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="coordinates" class="block text-sm font-medium text-gray-700">
                        Coordinate GPS
                    </label>
                    <input type="text" name="coordinates" id="coordinates"
                           value="{{ old('coordinates') }}"
                           placeholder="40.8518, 14.2681"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('coordinates') border-red-500 @enderror">
                    <p class="mt-1 text-xs text-gray-500">Formato: latitudine, longitudine</p>
                    @error('coordinates')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div class="space-y-4">
                    <div class="flex items-center">
                        <input type="checkbox" name="is_active" id="is_active" value="1"
                               {{ old('is_active', true) ? 'checked' : '' }}
                               class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                        <label for="is_active" class="ml-2 text-sm text-gray-700">
                            Zona Attiva
                        </label>
                    </div>
                    <p class="text-xs text-gray-500">Le zone non attive non sono visibili agli utenti</p>
                </div>
            </div>

            {{-- Custom Settings --}}
            <div class="mt-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Impostazioni Personalizzate (JSON)
                </label>
                <textarea name="settings" id="settings" rows="4"
                          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm font-mono text-xs @error('settings') border-red-500 @enderror"
                          placeholder='{"max_tournaments_per_month": 10, "auto_assign_referees": false}'>{{ old('settings', '{}') }}</textarea>
                <p class="mt-1 text-xs text-gray-500">
                    Impostazioni avanzate in formato JSON. Lascia vuoto per usare le impostazioni predefinite.
                </p>
                @error('settings')
                    <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                @enderror
            </div>
        </div>

        {{-- Actions --}}
        <div class="flex justify-end space-x-4">
            <a href="{{ route('super-admin.zones.index') }}"
               class="px-6 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Annulla
            </a>
            <button type="submit"
                    class="px-6 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Crea Zona
            </button>
        </div>
    </form>

    {{-- Help Box --}}
    <div class="mt-8 bg-gray-50 rounded-lg p-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4">Guida alla creazione delle zone</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm text-gray-600">
            <div>
                <h4 class="font-medium text-gray-900 mb-2">📍 Informazioni Base</h4>
                <ul class="space-y-1 list-disc list-inside">
                    <li>Il nome deve essere chiaro e identificativo</li>
                    <li>Il codice deve essere univoco (es: CAM per Campania)</li>
                    <li>La regione determina l'area geografica</li>
                </ul>
            </div>
            <div>
                <h4 class="font-medium text-gray-900 mb-2">👤 Amministratore</h4>
                <ul class="space-y-1 list-disc list-inside">
                    <li>Puoi assegnare un amministratore esistente</li>
                    <li>O crearlo successivamente dalla gestione utenti</li>
                    <li>L'amministratore gestirà tornei e arbitri della zona</li>
                </ul>
            </div>
            <div>
                <h4 class="font-medium text-gray-900 mb-2">⚙️ Impostazioni</h4>
                <ul class="space-y-1 list-disc list-inside">
                    <li>L'ordine determina la posizione negli elenchi</li>
                    <li>Le coordinate GPS possono essere utili per mappe</li>
                    <li>Le impostazioni JSON permettono configurazioni avanzate</li>
                </ul>
            </div>
            <div>
                <h4 class="font-medium text-gray-900 mb-2">📞 Contatti</h4>
                <ul class="space-y-1 list-disc list-inside">
                    <li>Email e telefono per comunicazioni ufficiali</li>
                    <li>Indirizzo sede per corrispondenza</li>
                    <li>Sito web per informazioni pubbliche</li>
                </ul>
            </div>
        </div>
    </div>
</div>

@push('scripts')
<script>
// Auto uppercase for code
document.getElementById('code').addEventListener('input', function() {
    this.value = this.value.toUpperCase();
});

// Validate JSON settings
document.getElementById('settings').addEventListener('blur', function() {
    if (this.value.trim() === '') {
        this.value = '{}';
        return;
    }

    try {
        JSON.parse(this.value);
        this.classList.remove('border-red-500');
    } catch (e) {
        this.classList.add('border-red-500');
        alert('Formato JSON non valido. Controlla la sintassi.');
    }
});

// Auto-fill coordinates (placeholder functionality)
document.getElementById('city').addEventListener('blur', function() {
    // Here you could integrate with a geocoding service
    // to automatically fill coordinates based on city
});
</script>
@endpush
@endsection
@extends('layouts.super-admin')

@section('title', 'Modifica Zona: ' . $zone->name)

@section('content')
<div class="container mx-auto px-4 py-8 max-w-4xl">
    {{-- Header --}}
    <div class="mb-8">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">Modifica Zona</h1>
                <p class="mt-2 text-gray-600">Modifica le impostazioni della zona: {{ $zone->name }}</p>
            </div>
            <div class="flex space-x-4">
                <a href="{{ route('super-admin.zones.show', $zone) }}"
                   class="text-gray-600 hover:text-gray-900 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                    </svg>
                    Visualizza
                </a>
                <a href="{{ route('super-admin.zones.index') }}"
                   class="text-gray-600 hover:text-gray-900 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    Torna all'elenco
                </a>
            </div>
        </div>
    </div>

    {{-- Alert if zone has content --}}
    @if($zone->users()->exists() || $zone->tournaments()->exists() || $zone->clubs()->exists())
    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
        <div class="flex">
            <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                </svg>
            </div>
            <div class="ml-3">
                <p class="text-sm text-yellow-700">
                    <strong>Attenzione:</strong> Questa zona ha {{ $zone->users()->count() }} utenti,
                    {{ $zone->tournaments()->count() }} tornei e {{ $zone->clubs()->count() }} clubs associati.
                    Le modifiche influenzeranno tutti i dati esistenti.
                </p>
            </div>
        </div>
    </div>
    @endif

    {{-- Form --}}
    <form action="{{ route('super-admin.zones.update', $zone) }}" method="POST" class="space-y-6">
        @csrf
        @method('PUT')

        {{-- Basic Information --}}
        <div class="bg-white shadow-sm rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">Informazioni Base</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700">
                        Nome Zona <span class="text-red-500">*</span>
                    </label>
                    <input type="text" name="name" id="name"
                           value="{{ old('name', $zone->name) }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('name') border-red-500 @enderror"
                           required>
                    @error('name')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="code" class="block text-sm font-medium text-gray-700">
                        Codice Zona <span class="text-red-500">*</span>
                    </label>
                    <input type="text" name="code" id="code"
                           value="{{ old('code', $zone->code) }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm uppercase @error('code') border-red-500 @enderror"
                           pattern="[A-Za-z0-9_-]+"
                           title="Solo lettere, numeri, trattini e underscore"
                           required>
                    <p class="mt-1 text-xs text-gray-500">Es: CAM, LOM, VEN, SIC</p>
                    @error('code')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="region" class="block text-sm font-medium text-gray-700">
                        Regione <span class="text-red-500">*</span>
                    </label>
                    <select name="region" id="region"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('region') border-red-500 @enderror"
                            required>
                        <option value="">Seleziona regione</option>
                        @foreach(['Abruzzo', 'Basilicata', 'Calabria', 'Campania', 'Emilia-Romagna', 'Friuli-Venezia Giulia', 'Lazio', 'Liguria', 'Lombardia', 'Marche', 'Molise', 'Piemonte', 'Puglia', 'Sardegna', 'Sicilia', 'Toscana', 'Trentino-Alto Adige', 'Umbria', "Valle d'Aosta", 'Veneto'] as $regionName)
                            <option value="{{ $regionName }}" {{ old('region', $zone->region) === $regionName ? 'selected' : '' }}>
                                {{ $regionName }}
                            </option>
                        @endforeach
                    </select>
                    @error('region')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="sort_order" class="block text-sm font-medium text-gray-700">
                        Ordine Visualizzazione
                    </label>
                    <input type="number" name="sort_order" id="sort_order"
                           value="{{ old('sort_order', $zone->sort_order) }}"
                           min="0"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('sort_order') border-red-500 @enderror">
                    <p class="mt-1 text-xs text-gray-500">Ordine crescente (0 = primo)</p>
                    @error('sort_order')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div class="col-span-2">
                    <label for="description" class="block text-sm font-medium text-gray-700">
                        Descrizione
                    </label>
                    <textarea name="description" id="description" rows="3"
                              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('description') border-red-500 @enderror">{{ old('description', $zone->description) }}</textarea>
                    @error('description')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>
            </div>
        </div>

        {{-- Contact Information --}}
        <div class="bg-white shadow-sm rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">Informazioni di Contatto</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="contact_email" class="block text-sm font-medium text-gray-700">
                        Email di Contatto
                    </label>
                    <input type="email" name="contact_email" id="contact_email"
                           value="{{ old('contact_email', $zone->contact_email) }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('contact_email') border-red-500 @enderror">
                    @error('contact_email')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="contact_phone" class="block text-sm font-medium text-gray-700">
                        Telefono di Contatto
                    </label>
                    <input type="tel" name="contact_phone" id="contact_phone"
                           value="{{ old('contact_phone', $zone->contact_phone) }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('contact_phone') border-red-500 @enderror">
                    @error('contact_phone')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div class="col-span-2">
                    <label for="address" class="block text-sm font-medium text-gray-700">
                        Indirizzo Sede
                    </label>
                    <input type="text" name="address" id="address"
                           value="{{ old('address', $zone->address) }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('address') border-red-500 @enderror">
                    @error('address')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="city" class="block text-sm font-medium text-gray-700">
                        Città
                    </label>
                    <input type="text" name="city" id="city"
                           value="{{ old('city', $zone->city) }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('city') border-red-500 @enderror">
                    @error('city')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="postal_code" class="block text-sm font-medium text-gray-700">
                        CAP
                    </label>
                    <input type="text" name="postal_code" id="postal_code"
                           value="{{ old('postal_code', $zone->postal_code) }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('postal_code') border-red-500 @enderror">
                    @error('postal_code')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div class="col-span-2">
                    <label for="website" class="block text-sm font-medium text-gray-700">
                        Sito Web
                    </label>
                    <input type="url" name="website" id="website"
                           value="{{ old('website', $zone->website) }}"
                           placeholder="https://www.esempio.it"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('website') border-red-500 @enderror">
                    @error('website')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>
            </div>
        </div>

        {{-- Administrator Assignment --}}
        <div class="bg-white shadow-sm rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">Amministratore Zona</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="admin_id" class="block text-sm font-medium text-gray-700">
                        Assegna Amministratore
                    </label>
                    <select name="admin_id" id="admin_id"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('admin_id') border-red-500 @enderror">
                        <option value="">Nessun amministratore</option>
                        @foreach($admins as $admin)
                            <option value="{{ $admin->id }}"
                                    {{ old('admin_id', $currentAdmin?->id) == $admin->id ? 'selected' : '' }}>
                                {{ $admin->name }} ({{ $admin->email }})
                            </option>
                        @endforeach
                    </select>
                    <p class="mt-1 text-xs text-gray-500">
                        Solo amministratori zona non ancora assegnati ad altre zone.
                    </p>
                    @error('admin_id')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                @if($currentAdmin)
                <div>
                    <label class="block text-sm font-medium text-gray-700">Amministratore Attuale</label>
                    <div class="mt-1 p-3 bg-gray-50 rounded-md">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 h-8 w-8">
                                @if($currentAdmin->profile_photo_path)
                                    <img class="h-8 w-8 rounded-full object-cover" src="{{ Storage::url($currentAdmin->profile_photo_path) }}" alt="">
                                @else
                                    <div class="h-8 w-8 rounded-full bg-indigo-500 flex items-center justify-center">
                                        <span class="text-white font-medium text-xs">{{ substr($currentAdmin->name, 0, 1) }}</span>
                                    </div>
                                @endif
                            </div>
                            <div class="ml-3">
                                <div class="text-sm font-medium text-gray-900">{{ $currentAdmin->name }}</div>
                                <div class="text-xs text-gray-500">{{ $currentAdmin->email }}</div>
                            </div>
                        </div>
                    </div>
                </div>
                @endif
            </div>
        </div>

        {{-- Advanced Settings --}}
        <div class="bg-white shadow-sm rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">Impostazioni Avanzate</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="coordinates" class="block text-sm font-medium text-gray-700">
                        Coordinate GPS
                    </label>
                    <input type="text" name="coordinates" id="coordinates"
                           value="{{ old('coordinates', $zone->coordinates) }}"
                           placeholder="40.8518, 14.2681"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('coordinates') border-red-500 @enderror">
                    <p class="mt-1 text-xs text-gray-500">Formato: latitudine, longitudine</p>
                    @error('coordinates')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div class="space-y-4">
                    <div class="flex items-center">
                        <input type="checkbox" name="is_active" id="is_active" value="1"
                               {{ old('is_active', $zone->is_active) ? 'checked' : '' }}
                               class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                        <label for="is_active" class="ml-2 text-sm text-gray-700">
                            Zona Attiva
                        </label>
                    </div>
                    <p class="text-xs text-gray-500">Le zone non attive non sono visibili agli utenti</p>
                </div>
            </div>

            {{-- Custom Settings --}}
            <div class="mt-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Impostazioni Personalizzate (JSON)
                </label>
                <textarea name="settings" id="settings" rows="4"
                          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm font-mono text-xs @error('settings') border-red-500 @enderror"
                          placeholder='{"max_tournaments_per_month": 10, "auto_assign_referees": false}'>{{ old('settings', json_encode($zone->settings ?? [], JSON_PRETTY_PRINT)) }}</textarea>
                <p class="mt-1 text-xs text-gray-500">
                    Impostazioni avanzate in formato JSON.
                </p>
                @error('settings')
                    <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                @enderror
            </div>
        </div>

        {{-- Actions --}}
        <div class="flex justify-between">
            <div>
                @if($zone->users()->count() == 0 && $zone->tournaments()->count() == 0 && $zone->clubs()->count() == 0)
                <button type="button" onclick="confirmDelete()"
                        class="px-4 py-2 border border-red-300 rounded-md shadow-sm text-sm font-medium text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                    <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                    Elimina Zona
                </button>
                @endif
            </div>
            <div class="flex space-x-4">
                <a href="{{ route('super-admin.zones.index') }}"
                   class="px-6 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Annulla
                </a>
                <button type="submit"
                        class="px-6 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Salva Modifiche
                </button>
            </div>
        </div>
    </form>

    {{-- Zone Statistics --}}
    <div class="mt-8 bg-gray-50 rounded-lg p-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4">Statistiche Zona</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-white rounded-lg p-4 text-center">
                <div class="text-2xl font-bold text-indigo-600">{{ $zone->users()->count() }}</div>
                <div class="text-sm text-gray-600">Utenti Totali</div>
            </div>
            <div class="bg-white rounded-lg p-4 text-center">
                <div class="text-2xl font-bold text-green-600">{{ $zone->tournaments()->count() }}</div>
                <div class="text-sm text-gray-600">Tornei Creati</div>
            </div>
            <div class="bg-white rounded-lg p-4 text-center">
                <div class="text-2xl font-bold text-blue-600">{{ $zone->clubs()->count() }}</div>
                <div class="text-sm text-gray-600">Clubs Registrati</div>
            </div>
        </div>
    </div>
</div>

{{-- Delete Form (hidden) --}}
<form id="delete-form" action="{{ route('super-admin.zones.destroy', $zone) }}" method="POST" style="display: none;">
    @csrf
    @method('DELETE')
</form>

@push('scripts')
<script>
// Auto uppercase for code
document.getElementById('code').addEventListener('input', function() {
    this.value = this.value.toUpperCase();
});

// Validate JSON settings
document.getElementById('settings').addEventListener('blur', function() {
    if (this.value.trim() === '') {
        this.value = '{}';
        return;
    }

    try {
        JSON.parse(this.value);
        this.classList.remove('border-red-500');
    } catch (e) {
        this.classList.add('border-red-500');
        alert('Formato JSON non valido. Controlla la sintassi.');
    }
});

function confirmDelete() {
    if (confirm('Sei sicuro di voler eliminare questa zona? Questa azione è irreversibile.')) {
        document.getElementById('delete-form').submit();
    }
}
</script>
@endpush
@endsection
@extends('layouts.super-admin')

@section('title', 'Gestione Zone')

@section('content')
<div class="container mx-auto px-4 py-8">
    {{-- Header --}}
    <div class="flex justify-between items-center mb-8">
        <div>
            <h1 class="text-3xl font-bold text-gray-900">Gestione Zone</h1>
            <p class="mt-2 text-gray-600">Gestisci le zone territoriali del sistema</p>
        </div>
        <div class="flex space-x-4">
            <button onclick="exportZones()"
                    class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-200 flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
                Esporta
            </button>
            <a href="{{ route('super-admin.zones.create') }}"
               class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition duration-200 flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                Nuova Zona
            </a>
        </div>
    </div>

    {{-- Statistics Cards --}}
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-2 bg-blue-100 rounded-lg">
                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Totale Zone</p>
                    <p class="text-2xl font-semibold text-gray-900">{{ $stats['total_zones'] }}</p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-2 bg-green-100 rounded-lg">
                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Zone Attive</p>
                    <p class="text-2xl font-semibold text-gray-900">{{ $stats['active_zones'] }}</p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-2 bg-purple-100 rounded-lg">
                    <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Totale Utenti</p>
                    <p class="text-2xl font-semibold text-gray-900">{{ $stats['total_users'] }}</p>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <div class="flex items-center">
                <div class="p-2 bg-yellow-100 rounded-lg">
                    <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-gray-500">Totale Tornei</p>
                    <p class="text-2xl font-semibold text-gray-900">{{ $stats['total_tournaments'] }}</p>
                </div>
            </div>
        </div>
    </div>

    {{-- Filters --}}
    <div class="bg-white rounded-lg shadow p-6 mb-6">
        <form method="GET" action="{{ route('super-admin.zones.index') }}" class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <div class="col-span-2">
                <label for="search" class="block text-sm font-medium text-gray-700">Cerca</label>
                <input type="text" name="search" id="search"
                       value="{{ request('search') }}"
                       placeholder="Nome zona, codice o descrizione..."
                       class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
            </div>

            <div>
                <label for="is_active" class="block text-sm font-medium text-gray-700">Stato</label>
                <select name="is_active" id="is_active"
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                    <option value="">Tutte</option>
                    <option value="1" {{ request('is_active') === '1' ? 'selected' : '' }}>Attive</option>
                    <option value="0" {{ request('is_active') === '0' ? 'selected' : '' }}>Non Attive</option>
                </select>
            </div>

            <div class="flex items-end space-x-2">
                <button type="submit"
                        class="flex-1 bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition duration-200">
                    Filtra
                </button>
                <a href="{{ route('super-admin.zones.index') }}"
                   class="bg-gray-300 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-400 transition duration-200">
                    Reset
                </a>
            </div>
        </form>
    </div>

    {{-- Zones Table --}}
    <div class="bg-white shadow-xl rounded-lg overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200" id="zones-table">
            <thead class="bg-gray-50">
                <tr>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Ordine
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Zona
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Regione / Contatti
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Amministratore
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Statistiche
                    </th>
                    <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                        Stato
                    </th>
                    <th scope="col" class="relative px-6 py-3">
                        <span class="sr-only">Azioni</span>
                    </th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200" id="sortable-zones">
                @forelse($zones as $zone)
                <tr data-id="{{ $zone->id }}" class="hover:bg-gray-50 transition-colors duration-150">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center">
                            <svg class="w-5 h-5 text-gray-400 cursor-move handle" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                            </svg>
                            <span class="ml-2 text-sm text-gray-500">{{ $zone->sort_order }}</span>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <div>
                            <div class="text-sm font-medium text-gray-900">{{ $zone->name }}</div>
                            <div class="text-sm text-gray-500">Codice: {{ $zone->code }}</div>
                            @if($zone->description)
                                <div class="text-xs text-gray-400 truncate max-w-xs">{{ $zone->description }}</div>
                            @endif
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">{{ $zone->region }}</div>
                        @if($zone->contact_email)
                            <div class="text-xs text-gray-500">📧 {{ $zone->contact_email }}</div>
                        @endif
                        @if($zone->contact_phone)
                            <div class="text-xs text-gray-500">📞 {{ $zone->contact_phone }}</div>
                        @endif
                        @if($zone->city)
                            <div class="text-xs text-gray-500">📍 {{ $zone->city }}</div>
                        @endif
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        @php
                            $admin = $zone->users()->where('user_type', 'zone_admin')->first();
                        @endphp
                        @if($admin)
                            <div class="flex items-center">
                                <div class="flex-shrink-0 h-8 w-8">
                                    @if($admin->profile_photo_path)
                                        <img class="h-8 w-8 rounded-full object-cover" src="{{ Storage::url($admin->profile_photo_path) }}" alt="">
                                    @else
                                        <div class="h-8 w-8 rounded-full bg-indigo-500 flex items-center justify-center">
                                            <span class="text-white font-medium text-xs">{{ substr($admin->name, 0, 1) }}</span>
                                        </div>
                                    @endif
                                </div>
                                <div class="ml-2">
                                    <div class="text-sm font-medium text-gray-900">{{ $admin->name }}</div>
                                    <div class="text-xs text-gray-500">{{ $admin->email }}</div>
                                </div>
                            </div>
                        @else
                            <span class="text-sm text-gray-400 italic">Nessun amministratore</span>
                        @endif
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        <div>Utenti: {{ $zone->users_count }}</div>
                        <div>Tornei: {{ $zone->tournaments_count }}</div>
                        <div>Clubs: {{ $zone->clubs_count }}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-center">
                        <button onclick="toggleActive({{ $zone->id }})"
                                class="relative inline-flex items-center h-6 rounded-full w-11 transition-colors duration-200 focus:outline-none
                                {{ $zone->is_active ? 'bg-green-500' : 'bg-gray-300' }}">
                            <span class="sr-only">Attiva/Disattiva</span>
                            <span class="inline-block w-4 h-4 transform transition-transform duration-200 bg-white rounded-full shadow
                                {{ $zone->is_active ? 'translate-x-6' : 'translate-x-1' }}"></span>
                        </button>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <div class="flex items-center justify-end space-x-2">
                            <a href="{{ route('super-admin.zones.show', $zone) }}"
                               class="text-gray-600 hover:text-gray-900" title="Visualizza">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </a>
                            <a href="{{ route('super-admin.zones.edit', $zone) }}"
                               class="text-indigo-600 hover:text-indigo-900" title="Modifica">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                            </a>
                            <button onclick="duplicateZone({{ $zone->id }})"
                                    class="text-blue-600 hover:text-blue-900" title="Duplica">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                </svg>
                            </button>
                            @if($zone->users_count == 0 && $zone->tournaments_count == 0 && $zone->clubs_count == 0)
                            <form action="{{ route('super-admin.zones.destroy', $zone) }}"
                                  method="POST"
                                  class="inline"
                                  onsubmit="return confirm('Sei sicuro di voler eliminare questa zona?');">
                                @csrf
                                @method('DELETE')
                                <button type="submit" class="text-red-600 hover:text-red-900" title="Elimina">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                    </svg>
                                </button>
                            </form>
                            @endif
                        </div>
                    </td>
                </tr>
                @empty
                <tr>
                    <td colspan="7" class="px-6 py-12 text-center text-gray-500">
                        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        <p class="mt-2">Nessuna zona trovata</p>
                    </td>
                </tr>
                @endforelse
            </tbody>
        </table>
    </div>

    {{-- Pagination --}}
    @if($zones->hasPages())
        <div class="mt-6">
            {{ $zones->appends(request()->query())->links() }}
        </div>
    @endif

    {{-- Info Box --}}
    <div class="mt-8 bg-blue-50 border-l-4 border-blue-400 p-4">
        <div class="flex">
            <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                </svg>
            </div>
            <div class="ml-3">
                <p class="text-sm text-blue-700">
                    <strong>Suggerimento:</strong> Puoi riordinare le zone trascinandole.
                    Le zone con utenti, tornei o clubs associati non possono essere eliminate.
                </p>
            </div>
        </div>
    </div>
</div>

@push('scripts')
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
<script>
// Sortable zones
document.addEventListener('DOMContentLoaded', function() {
    const sortable = Sortable.create(document.getElementById('sortable-zones'), {
        handle: '.handle',
        animation: 150,
        onEnd: function(evt) {
            const zones = [];
            document.querySelectorAll('#sortable-zones tr').forEach((row, index) => {
                if (row.dataset.id) {
                    zones.push({
                        id: row.dataset.id,
                        sort_order: index * 10
                    });
                }
            });

            fetch('{{ route("super-admin.zones.update-order") }}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': '{{ csrf_token() }}'
                },
                body: JSON.stringify({ zones })
            });
        }
    });
});

// Toggle active status
function toggleActive(zoneId) {
    fetch(`/super-admin/zones/${zoneId}/toggle-active`, {
        method: 'POST',
        headers: {
            'X-CSRF-TOKEN': '{{ csrf_token() }}',
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            location.reload();
        }
    });
}

// Duplicate zone
function duplicateZone(zoneId) {
    if (confirm('Vuoi duplicare questa zona?')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/super-admin/zones/${zoneId}/duplicate`;

        const token = document.createElement('input');
        token.type = 'hidden';
        token.name = '_token';
        token.value = '{{ csrf_token() }}';
        form.appendChild(token);

        document.body.appendChild(form);
        form.submit();
    }
}

// Export zones
function exportZones() {
    window.location.href = '{{ route("super-admin.zones.export") }}';
}
</script>
@endpush
@endsection
@extends('layouts.super-admin')

@section('title', 'Modifica Zona: ' . $zone->name)

@section('content')
<div class="container mx-auto px-4 py-8 max-w-4xl">
    {{-- Header --}}
    <div class="mb-8">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">Modifica Zona</h1>
                <p class="mt-2 text-gray-600">Modifica le impostazioni della zona: {{ $zone->name }}</p>
            </div>
            <div class="flex space-x-4">
                <a href="{{ route('super-admin.zones.show', $zone) }}"
                   class="text-gray-600 hover:text-gray-900 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                    </svg>
                    Visualizza
                </a>
                <a href="{{ route('super-admin.zones.index') }}"
                   class="text-gray-600 hover:text-gray-900 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    Torna all'elenco
                </a>
            </div>
        </div>
    </div>

    {{-- Alert if zone has content --}}
    @if($zone->users()->exists() || $zone->tournaments()->exists() || $zone->clubs()->exists())
    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
        <div class="flex">
            <div class="flex-shrink-0">
                <svg class="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                </svg>
            </div>
            <div class="ml-3">
                <p class="text-sm text-yellow-700">
                    <strong>Attenzione:</strong> Questa zona ha {{ $zone->users()->count() }} utenti,
                    {{ $zone->tournaments()->count() }} tornei e {{ $zone->clubs()->count() }} clubs associati.
                    Le modifiche influenzeranno tutti i dati esistenti.
                </p>
            </div>
        </div>
    </div>
    @endif

    {{-- Form --}}
    <form action="{{ route('super-admin.zones.update', $zone) }}" method="POST" class="space-y-6">
        @csrf
        @method('PUT')

        {{-- Basic Information --}}
        <div class="bg-white shadow-sm rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">Informazioni Base</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700">
                        Nome Zona <span class="text-red-500">*</span>
                    </label>
                    <input type="text" name="name" id="name"
                           value="{{ old('name', $zone->name) }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('name') border-red-500 @enderror"
                           required>
                    @error('name')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="code" class="block text-sm font-medium text-gray-700">
                        Codice Zona <span class="text-red-500">*</span>
                    </label>
                    <input type="text" name="code" id="code"
                           value="{{ old('code', $zone->code) }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm uppercase @error('code') border-red-500 @enderror"
                           pattern="[A-Za-z0-9_-]+"
                           title="Solo lettere, numeri, trattini e underscore"
                           required>
                    <p class="mt-1 text-xs text-gray-500">Es: CAM, LOM, VEN, SIC</p>
                    @error('code')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="region" class="block text-sm font-medium text-gray-700">
                        Regione <span class="text-red-500">*</span>
                    </label>
                    <select name="region" id="region"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('region') border-red-500 @enderror"
                            required>
                        <option value="">Seleziona regione</option>
                        @foreach(['Abruzzo', 'Basilicata', 'Calabria', 'Campania', 'Emilia-Romagna', 'Friuli-Venezia Giulia', 'Lazio', 'Liguria', 'Lombardia', 'Marche', 'Molise', 'Piemonte', 'Puglia', 'Sardegna', 'Sicilia', 'Toscana', 'Trentino-Alto Adige', 'Umbria', "Valle d'Aosta", 'Veneto'] as $regionName)
                            <option value="{{ $regionName }}" {{ old('region', $zone->region) === $regionName ? 'selected' : '' }}>
                                {{ $regionName }}
                            </option>
                        @endforeach
                    </select>
                    @error('region')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="sort_order" class="block text-sm font-medium text-gray-700">
                        Ordine Visualizzazione
                    </label>
                    <input type="number" name="sort_order" id="sort_order"
                           value="{{ old('sort_order', $zone->sort_order) }}"
                           min="0"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('sort_order') border-red-500 @enderror">
                    <p class="mt-1 text-xs text-gray-500">Ordine crescente (0 = primo)</p>
                    @error('sort_order')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div class="col-span-2">
                    <label for="description" class="block text-sm font-medium text-gray-700">
                        Descrizione
                    </label>
                    <textarea name="description" id="description" rows="3"
                              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('description') border-red-500 @enderror">{{ old('description', $zone->description) }}</textarea>
                    @error('description')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>
            </div>
        </div>

        {{-- Contact Information --}}
        <div class="bg-white shadow-sm rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">Informazioni di Contatto</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="contact_email" class="block text-sm font-medium text-gray-700">
                        Email di Contatto
                    </label>
                    <input type="email" name="contact_email" id="contact_email"
                           value="{{ old('contact_email', $zone->contact_email) }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('contact_email') border-red-500 @enderror">
                    @error('contact_email')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="contact_phone" class="block text-sm font-medium text-gray-700">
                        Telefono di Contatto
                    </label>
                    <input type="tel" name="contact_phone" id="contact_phone"
                           value="{{ old('contact_phone', $zone->contact_phone) }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('contact_phone') border-red-500 @enderror">
                    @error('contact_phone')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div class="col-span-2">
                    <label for="address" class="block text-sm font-medium text-gray-700">
                        Indirizzo Sede
                    </label>
                    <input type="text" name="address" id="address"
                           value="{{ old('address', $zone->address) }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('address') border-red-500 @enderror">
                    @error('address')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="city" class="block text-sm font-medium text-gray-700">
                        Città
                    </label>
                    <input type="text" name="city" id="city"
                           value="{{ old('city', $zone->city) }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('city') border-red-500 @enderror">
                    @error('city')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div>
                    <label for="postal_code" class="block text-sm font-medium text-gray-700">
                        CAP
                    </label>
                    <input type="text" name="postal_code" id="postal_code"
                           value="{{ old('postal_code', $zone->postal_code) }}"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('postal_code') border-red-500 @enderror">
                    @error('postal_code')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div class="col-span-2">
                    <label for="website" class="block text-sm font-medium text-gray-700">
                        Sito Web
                    </label>
                    <input type="url" name="website" id="website"
                           value="{{ old('website', $zone->website) }}"
                           placeholder="https://www.esempio.it"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('website') border-red-500 @enderror">
                    @error('website')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>
            </div>
        </div>

        {{-- Administrator Assignment --}}
        <div class="bg-white shadow-sm rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">Amministratore Zona</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="admin_id" class="block text-sm font-medium text-gray-700">
                        Assegna Amministratore
                    </label>
                    <select name="admin_id" id="admin_id"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('admin_id') border-red-500 @enderror">
                        <option value="">Nessun amministratore</option>
                        @foreach($admins as $admin)
                            <option value="{{ $admin->id }}"
                                    {{ old('admin_id', $currentAdmin?->id) == $admin->id ? 'selected' : '' }}>
                                {{ $admin->name }} ({{ $admin->email }})
                            </option>
                        @endforeach
                    </select>
                    <p class="mt-1 text-xs text-gray-500">
                        Solo amministratori zona non ancora assegnati ad altre zone.
                    </p>
                    @error('admin_id')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                @if($currentAdmin)
                <div>
                    <label class="block text-sm font-medium text-gray-700">Amministratore Attuale</label>
                    <div class="mt-1 p-3 bg-gray-50 rounded-md">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 h-8 w-8">
                                @if($currentAdmin->profile_photo_path)
                                    <img class="h-8 w-8 rounded-full object-cover" src="{{ Storage::url($currentAdmin->profile_photo_path) }}" alt="">
                                @else
                                    <div class="h-8 w-8 rounded-full bg-indigo-500 flex items-center justify-center">
                                        <span class="text-white font-medium text-xs">{{ substr($currentAdmin->name, 0, 1) }}</span>
                                    </div>
                                @endif
                            </div>
                            <div class="ml-3">
                                <div class="text-sm font-medium text-gray-900">{{ $currentAdmin->name }}</div>
                                <div class="text-xs text-gray-500">{{ $currentAdmin->email }}</div>
                            </div>
                        </div>
                    </div>
                </div>
                @endif
            </div>
        </div>

        {{-- Advanced Settings --}}
        <div class="bg-white shadow-sm rounded-lg p-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-6">Impostazioni Avanzate</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="coordinates" class="block text-sm font-medium text-gray-700">
                        Coordinate GPS
                    </label>
                    <input type="text" name="coordinates" id="coordinates"
                           value="{{ old('coordinates', $zone->coordinates) }}"
                           placeholder="40.8518, 14.2681"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm @error('coordinates') border-red-500 @enderror">
                    <p class="mt-1 text-xs text-gray-500">Formato: latitudine, longitudine</p>
                    @error('coordinates')
                        <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                    @enderror
                </div>

                <div class="space-y-4">
                    <div class="flex items-center">
                        <input type="checkbox" name="is_active" id="is_active" value="1"
                               {{ old('is_active', $zone->is_active) ? 'checked' : '' }}
                               class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                        <label for="is_active" class="ml-2 text-sm text-gray-700">
                            Zona Attiva
                        </label>
                    </div>
                    <p class="text-xs text-gray-500">Le zone non attive non sono visibili agli utenti</p>
                </div>
            </div>

            {{-- Custom Settings --}}
            <div class="mt-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Impostazioni Personalizzate (JSON)
                </label>
                <textarea name="settings" id="settings" rows="4"
                          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm font-mono text-xs @error('settings') border-red-500 @enderror"
                          placeholder='{"max_tournaments_per_month": 10, "auto_assign_referees": false}'>{{ old('settings', json_encode($zone->settings ?? [], JSON_PRETTY_PRINT)) }}</textarea>
                <p class="mt-1 text-xs text-gray-500">
                    Impostazioni avanzate in formato JSON.
                </p>
                @error('settings')
                    <p class="mt-1 text-sm text-red-600">{{ $message }}</p>
                @enderror
            </div>
        </div>

        {{-- Actions --}}
        <div class="flex justify-between">
            <div>
                @if($zone->users()->count() == 0 && $zone->tournaments()->count() == 0 && $zone->clubs()->count() == 0)
                <button type="button" onclick="confirmDelete()"
                        class="px-4 py-2 border border-red-300 rounded-md shadow-sm text-sm font-medium text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                    <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                    Elimina Zona
                </button>
                @endif
            </div>
            <div class="flex space-x-4">
                <a href="{{ route('super-admin.zones.index') }}"
                   class="px-6 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Annulla
                </a>
                <button type="submit"
                        class="px-6 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Salva Modifiche
                </button>
            </div>
        </div>
    </form>

    {{-- Zone Statistics --}}
    <div class="mt-8 bg-gray-50 rounded-lg p-6">
        <h3 class="text-lg font-medium text-gray-900 mb-4">Statistiche Zona</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-white rounded-lg p-4 text-center">
                <div class="text-2xl font-bold text-indigo-600">{{ $zone->users()->count() }}</div>
                <div class="text-sm text-gray-600">Utenti Totali</div>
            </div>
            <div class="bg-white rounded-lg p-4 text-center">
                <div class="text-2xl font-bold text-green-600">{{ $zone->tournaments()->count() }}</div>
                <div class="text-sm text-gray-600">Tornei Creati</div>
            </div>
            <div class="bg-white rounded-lg p-4 text-center">
                <div class="text-2xl font-bold text-blue-600">{{ $zone->clubs()->count() }}</div>
                <div class="text-sm text-gray-600">Clubs Registrati</div>
            </div>
        </div>
    </div>
</div>

{{-- Delete Form (hidden) --}}
<form id="delete-form" action="{{ route('super-admin.zones.destroy', $zone) }}" method="POST" style="display: none;">
    @csrf
    @method('DELETE')
</form>

@push('scripts')
<script>
// Auto uppercase for code
document.getElementById('code').addEventListener('input', function() {
    this.value = this.value.toUpperCase();
});

// Validate JSON settings
document.getElementById('settings').addEventListener('blur', function() {
    if (this.value.trim() === '') {
        this.value = '{}';
        return;
    }

    try {
        JSON.parse(this.value);
        this.classList.remove('border-red-500');
    } catch (e) {
        this.classList.add('border-red-500');
        alert('Formato JSON non valido. Controlla la sintassi.');
    }
});

function confirmDelete() {
    if (confirm('Sei sicuro di voler eliminare questa zona? Questa azione è irreversibile.')) {
        document.getElementById('delete-form').submit();
    }
}
</script>
@endpush
@endsection
